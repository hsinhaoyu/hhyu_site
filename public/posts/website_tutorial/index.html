<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  
  <title>How this website was built - a tutorial</title>
  <meta property="og:title" content="How this website was built - a tutorial" />
  <meta name="twitter:title" content="How this website was built - a tutorial" />
  

  
  <meta name="description" content="Science, programming, books, and other interesting stuff">
  <meta property="og:description" content="Science, programming, books, and other interesting stuff">
  <meta name="twitter:description" content="Science, programming, books, and other interesting stuff">
  

  <meta name="author" content="Hsin-Hao Yu"/>
  <meta property="og:site_name" content="Cortically Magnified" />
  <meta property="og:url" content="https://www.hhyu.org/posts/website_tutorial/" />

  
  <meta name="twitter:card" content="summary" />

  
  <meta name="twitter:site" content="@HsinHaoYu" />
  <meta name="twitter:creator" content="@HsinHaoYu" />
  

  
  <meta property="og:type" content="article" />
  
  
  
  <meta name="generator" content="Hugo 0.79.0" />
  
  

  <link rel="stylesheet" href="https://www.hhyu.org/css/style.css" />
  
  
  <link rel='icon' type='image/x-icon' href="https://www.hhyu.org/path/to/favicon" />
  

    
  
  <script type="text/javascript" src="https://www.hhyu.org/js/bundle.js"></script>
  <link rel="authorization_endpoint" href="https://indieauth.com/auth">
<link rel="token_endpoint" href="https://tokens.indieauth.com/token">
<link rel="micropub" href="https://lr85f9rofe.execute-api.ap-southeast-2.amazonaws.com/Prod/">
<link rel="microsub" href="https://aperture.p3k.io/microsub/592">
<link rel="webmention" href="https://webmention.io/hhyu.org/webmention" />
<link rel="pingback" href="https://webmention.io/hhyu.org/xmlrpc" />

</head>

<body>
  <a href="#main" class="skip-link p-screen-reader-text">Skip to content</a>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;" aria-hidden="true"> <symbol id="icon-500px" viewBox="0 0 16 16"><g> <path d="M3.953 10.512a5.24 5.24 0 0 0 6.996 3.141c.625-.262 1.184-.641 1.666-1.122s.859-1.041 1.122-1.666c.272-.647.412-1.331.412-2.037s-.137-1.394-.412-2.037c-.262-.625-.641-1.184-1.122-1.666s-1.041-.859-1.666-1.122a5.226 5.226 0 0 0-2.037-.413c-.716 0-1.431.144-2.066.413-.509.216-1.372.769-1.875 1.291l-.003.003V.984h7.241c.262-.003.262-.372.262-.491 0-.122 0-.487-.266-.491H4.377a.343.343 0 0 0-.344.341v6.066c0 .197.244.338.472.384.444.094.544-.047.653-.197l.016-.019c.166-.247.681-.766.688-.772a4.262 4.262 0 0 1 3.037-1.25c1.147 0 2.222.444 3.028 1.25a4.245 4.245 0 0 1 1.256 3.019 4.236 4.236 0 0 1-1.25 3.019 4.336 4.336 0 0 1-3.047 1.25 4.136 4.136 0 0 1-2.159-.597l.003-3.688c0-.491.213-1.028.572-1.431a2.09 2.09 0 0 1 1.588-.716c.594 0 1.15.225 1.566.634.409.406.637.95.637 1.528a2.179 2.179 0 0 1-2.206 2.197c-.238 0-.672-.106-.691-.109-.25-.075-.356.272-.391.387-.134.441.069.528.109.541.397.125.659.147 1.003.147a3.173 3.173 0 0 0 3.169-3.169c0-1.734-1.422-3.144-3.166-3.144-.856 0-1.659.328-2.263.919-.575.566-.903 1.319-.903 2.069v.019c-.003.094-.003 2.306-.006 3.031l-.003-.003c-.328-.363-.653-.919-.869-1.488-.084-.222-.275-.184-.534-.103-.125.034-.469.141-.391.394zm3.722-.865c0 .106.097.2.156.253l.019.019c.1.097.194.147.281.147a.181.181 0 0 0 .131-.05c.044-.041.537-.544.588-.591l.553.55c.05.056.106.088.172.088.088 0 .184-.053.284-.156.238-.244.119-.375.063-.438l-.559-.559.584-.588c.128-.137.016-.284-.097-.397-.162-.162-.322-.206-.422-.112l-.581.581-.588-.588a.16.16 0 0 0-.113-.047c-.078 0-.172.053-.275.156-.181.181-.219.306-.125.406l.588.584-.584.584c-.053.05-.078.103-.075.156zm1.278-7.931c-.938 0-1.938.191-2.669.506a.207.207 0 0 0-.134.181.753.753 0 0 0 .069.337c.047.116.166.425.4.334a6.689 6.689 0 0 1 2.334-.444 6.35 6.35 0 0 1 2.469.497c.622.263 1.206.644 1.844 1.194a.22.22 0 0 0 .147.059c.125 0 .244-.122.347-.237.169-.191.287-.35.119-.509a6.858 6.858 0 0 0-2.1-1.356 7.326 7.326 0 0 0-2.825-.563zM14.006 13.3c-.113-.113-.209-.178-.294-.203s-.162-.006-.222.053l-.056.056a6.32 6.32 0 0 1-6.938 1.356 6.336 6.336 0 0 1-2.013-1.356 6.046 6.046 0 0 1-1.356-2.012c-.288-.713-.381-1.247-.413-1.422-.003-.016-.006-.028-.006-.037-.041-.206-.231-.222-.503-.178-.112.019-.459.072-.428.319v.006a7.261 7.261 0 0 0 2.04 3.994 7.266 7.266 0 0 0 10.288 0l.059-.059c.069-.084.134-.225-.159-.516z"/> </g></symbol> <symbol id="icon-codepen" viewBox="0 0 16 16"><g> <path d="M14.777 5.751l-7-4.667a.5.5 0 0 0-.555 0l-7 4.667a.501.501 0 0 0-.223.416v4.667c0 .167.084.323.223.416l7 4.667a.5.5 0 0 0 .554 0l7-4.667a.501.501 0 0 0 .223-.416V6.167a.501.501 0 0 0-.223-.416zM7.5 10.232L4.901 8.5 7.5 6.768 10.099 8.5 7.5 10.232zM8 5.899V2.434l5.599 3.732L11 7.898l-3-2zm-1 0l-3 2-2.599-1.732L7 2.435V5.9zM3.099 8.5L1 9.899V7.101L3.099 8.5zM4 9.101l3 2v3.465l-5.599-3.732L4 9.102zm4 2l3-2 2.599 1.732L8 14.565V11.1zM11.901 8.5L14 7.101v2.798L11.901 8.5z"/> </g></symbol> <symbol id="icon-dribbble" viewBox="0 0 16 16"><g> <path d="M8 16c-4.412 0-8-3.588-8-8s3.587-8 8-8c4.412 0 8 3.587 8 8s-3.588 8-8 8zm6.747-6.906c-.234-.075-2.116-.634-4.256-.291a29.7 29.7 0 0 1 1.328 4.872 6.845 6.845 0 0 0 2.928-4.581zM10.669 14.3c-.103-.6-.497-2.688-1.456-5.181-.016.006-.031.009-.044.016-3.856 1.344-5.241 4.016-5.362 4.266a6.807 6.807 0 0 0 6.863.9zm-7.747-1.722c.156-.266 2.031-3.369 5.553-4.509a7.04 7.04 0 0 1 .269-.081 24.04 24.04 0 0 0-.553-1.159c-3.409 1.022-6.722.978-7.022.975-.003.069-.003.138-.003.209 0 1.753.666 3.356 1.756 4.566zM1.313 6.609c.306.003 3.122.016 6.319-.831a43.092 43.092 0 0 0-2.534-3.953 6.854 6.854 0 0 0-3.784 4.784zM6.4 1.366a36.612 36.612 0 0 1 2.55 4c2.431-.909 3.459-2.294 3.581-2.469A6.799 6.799 0 0 0 6.4 1.366zm6.891 2.325c-.144.194-1.291 1.663-3.816 2.694.159.325.313.656.453.991.05.119.1.234.147.353 2.275-.284 4.534.172 4.759.219a6.816 6.816 0 0 0-1.544-4.256z"/> </g></symbol> <symbol id="icon-facebook" viewBox="0 0 16 16"><g> <path d="M9.5 3H12V0H9.5C7.57 0 6 1.57 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.271.229-.5.5-.5z"/> </g></symbol> <symbol id="icon-feed" viewBox="0 0 16 16"><g> <path d="M2.13 11.733c-1.175 0-2.13.958-2.13 2.126 0 1.174.955 2.122 2.13 2.122a2.126 2.126 0 0 0 2.133-2.122 2.133 2.133 0 0 0-2.133-2.126zM.002 5.436v3.067c1.997 0 3.874.781 5.288 2.196a7.45 7.45 0 0 1 2.192 5.302h3.08c0-5.825-4.739-10.564-10.56-10.564zM.006 0v3.068C7.128 3.068 12.924 8.87 12.924 16H16C16 7.18 8.824 0 .006 0z"/> </g></symbol> <symbol id="icon-flickr" viewBox="0 0 16 16"><g> <path d="M0 8.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0zm9 0a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/> </g></symbol> <symbol id="icon-github" viewBox="0 0 16 16"><g> <path d="M8 .198a8 8 0 0 0-2.529 15.591c.4.074.547-.174.547-.385 0-.191-.008-.821-.011-1.489-2.226.484-2.695-.944-2.695-.944-.364-.925-.888-1.171-.888-1.171-.726-.497.055-.486.055-.486.803.056 1.226.824 1.226.824.714 1.223 1.872.869 2.328.665.072-.517.279-.87.508-1.07-1.777-.202-3.645-.888-3.645-3.954 0-.873.313-1.587.824-2.147-.083-.202-.357-1.015.077-2.117 0 0 .672-.215 2.201.82A7.672 7.672 0 0 1 8 4.066c.68.003 1.365.092 2.004.269 1.527-1.035 2.198-.82 2.198-.82.435 1.102.162 1.916.079 2.117.513.56.823 1.274.823 2.147 0 3.073-1.872 3.749-3.653 3.947.287.248.543.735.543 1.481 0 1.07-.009 1.932-.009 2.195 0 .213.144.462.55.384A8 8 0 0 0 8.001.196z"/> </g></symbol> <symbol id="icon-gitlab" viewBox="0 0 28 28"><g> <path d="M1.625 11.031L14 26.89.437 17.046a1.092 1.092 0 0 1-.391-1.203l1.578-4.813zm7.219 0h10.313L14.001 26.89zM5.75 1.469l3.094 9.562H1.625l3.094-9.562a.548.548 0 0 1 1.031 0zm20.625 9.562l1.578 4.813a1.09 1.09 0 0 1-.391 1.203l-13.563 9.844 12.375-15.859zm0 0h-7.219l3.094-9.562a.548.548 0 0 1 1.031 0z"/> </g></symbol> <symbol id="icon-google-plus" viewBox="0 0 16 16"><g> <path d="M5.091 7.147v1.747h2.888c-.116.75-.872 2.197-2.888 2.197-1.737 0-3.156-1.441-3.156-3.216s1.419-3.216 3.156-3.216c.991 0 1.65.422 2.028.784L8.5 4.112c-.888-.828-2.037-1.331-3.409-1.331C2.275 2.784 0 5.059 0 7.875s2.275 5.091 5.091 5.091c2.937 0 4.888-2.066 4.888-4.975 0-.334-.037-.591-.081-.844H5.092zM16 7h-1.5V5.5H13V7h-1.5v1.5H13V10h1.5V8.5H16z"/> </g></symbol> <symbol id="icon-instagram" viewBox="0 0 22 22"><g> <path d="M15.445 0H6.554A6.559 6.559 0 0 0 0 6.554v8.891A6.559 6.559 0 0 0 6.554 22h8.891a6.56 6.56 0 0 0 6.554-6.555V6.554A6.557 6.557 0 0 0 15.445 0zm4.342 15.445a4.343 4.343 0 0 1-4.342 4.342H6.554a4.341 4.341 0 0 1-4.341-4.342V6.554a4.34 4.34 0 0 1 4.341-4.341h8.891a4.342 4.342 0 0 1 4.341 4.341l.001 8.891z"/> <path d="M11 5.312A5.693 5.693 0 0 0 5.312 11 5.694 5.694 0 0 0 11 16.688 5.694 5.694 0 0 0 16.688 11 5.693 5.693 0 0 0 11 5.312zm0 9.163a3.475 3.475 0 1 1-.001-6.95 3.475 3.475 0 0 1 .001 6.95zm5.7-10.484a1.363 1.363 0 1 1-1.364 1.364c0-.752.51-1.364 1.364-1.364z"/> </g></symbol> <symbol id="icon-linkedin" viewBox="0 0 16 16"><g> <path d="M6 6h2.767v1.418h.04C9.192 6.727 10.134 6 11.539 6 14.46 6 15 7.818 15 10.183V15h-2.885v-4.27c0-1.018-.021-2.329-1.5-2.329-1.502 0-1.732 1.109-1.732 2.255V15H6V6zM1 6h3v9H1V6zM4 3.5a1.5 1.5 0 1 1-3.001-.001A1.5 1.5 0 0 1 4 3.5z"/> </g></symbol> <symbol id="icon-mail" viewBox="0 0 22 18"><g> <path fill="#000" d="M0 17.225V.776h22v16.447H0v.002zm3.011-1.815h15.978l-5.111-5.115L11 13.179l-2.877-2.883-5.112 5.114zm-1.216-1.275l5.077-5.09L1.795 3.98v10.155zm13.332-5.09l5.079 5.09V3.979l-5.079 5.066zm-4.126 1.588l8.022-8.027-16.045-.001 8.023 8.028z"/> </g></symbol> <symbol id="icon-medium" viewBox="0 0 24 24"><g> <path d="M22.085 4.733L24 2.901V2.5h-6.634l-4.728 11.768L7.259 2.5H.303v.401L2.54 5.594c.218.199.332.49.303.783V16.96c.069.381-.055.773-.323 1.05L0 21.064v.396h7.145v-.401l-2.52-3.049a1.244 1.244 0 0 1-.347-1.05V7.806l6.272 13.659h.729l5.393-13.659v10.881c0 .287 0 .346-.188.534l-1.94 1.877v.402h9.412v-.401l-1.87-1.831a.556.556 0 0 1-.214-.534V5.267a.554.554 0 0 1 .213-.534z"/> </g></symbol> <symbol id="icon-npm" viewBox="0 0 16 16"><g> <path d="M0 0v16h16V0H0zm13 13h-2V5H8v8H3V3h10v10z"/> </g></symbol> <symbol id="icon-pinterest" viewBox="0 0 16 16"><g> <path d="M8 1.069a6.93 6.93 0 0 0-2.525 13.384c-.059-.547-.116-1.391.025-1.988.125-.541.813-3.444.813-3.444s-.206-.416-.206-1.028c0-.963.559-1.684 1.253-1.684.591 0 .878.444.878.975 0 .594-.378 1.484-.575 2.306-.166.691.344 1.253 1.025 1.253 1.231 0 2.178-1.3 2.178-3.175 0-1.659-1.194-2.819-2.894-2.819-1.972 0-3.128 1.478-3.128 3.009 0 .597.228 1.234.516 1.581.056.069.066.128.047.2a95.89 95.89 0 0 1-.194.787c-.031.128-.1.153-.231.094-.866-.403-1.406-1.669-1.406-2.684 0-2.188 1.587-4.194 4.578-4.194 2.403 0 4.272 1.712 4.272 4.003 0 2.388-1.506 4.313-3.597 4.313-.703 0-1.362-.366-1.588-.797 0 0-.347 1.322-.431 1.647-.156.603-.578 1.356-.862 1.816a6.93 6.93 0 0 0 8.984-6.622 6.931 6.931 0 0 0-6.931-6.934z"/> </g></symbol> <symbol id="icon-search" viewBox="0 0 16 16"><g> <path d="M15.504 13.616l-3.79-3.223c-.392-.353-.811-.514-1.149-.499a6 6 0 1 0-.672.672c-.016.338.146.757.499 1.149l3.223 3.79c.552.613 1.453.665 2.003.115s.498-1.452-.115-2.003zM6 10a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/> </g></symbol> <symbol id="icon-strava" viewBox="0 0 24 24"><g> <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/> </g></symbol> <symbol id="icon-tumblr" viewBox="0 0 16 16"><g> <path d="M9.001 7v3.659c0 .928-.012 1.463.086 1.727.098.262.342.534.609.691.354.212.758.318 1.214.318.81 0 1.289-.107 2.09-.633v2.405a9.089 9.089 0 0 1-1.833.639A7.93 7.93 0 0 1 9.369 16a4.9 4.9 0 0 1-1.725-.276 4.195 4.195 0 0 1-1.438-.79c-.398-.343-.672-.706-.826-1.091s-.23-.944-.23-1.676V6.556H3.003V4.29c.628-.204 1.331-.497 1.778-.877a4.386 4.386 0 0 0 1.08-1.374C6.133 1.505 6.32.825 6.422 0h2.579v4H13v3H9.001z"/> </g></symbol> <symbol id="icon-twitter" viewBox="0 0 16 16"><g> <path d="M16 3.538a6.461 6.461 0 0 1-1.884.516 3.301 3.301 0 0 0 1.444-1.816 6.607 6.607 0 0 1-2.084.797 3.28 3.28 0 0 0-2.397-1.034 3.28 3.28 0 0 0-3.197 4.028 9.321 9.321 0 0 1-6.766-3.431 3.284 3.284 0 0 0 1.015 4.381A3.301 3.301 0 0 1 .643 6.57v.041A3.283 3.283 0 0 0 3.277 9.83a3.291 3.291 0 0 1-1.485.057 3.293 3.293 0 0 0 3.066 2.281 6.586 6.586 0 0 1-4.862 1.359 9.286 9.286 0 0 0 5.034 1.475c6.037 0 9.341-5.003 9.341-9.341 0-.144-.003-.284-.009-.425a6.59 6.59 0 0 0 1.637-1.697z"/> </g></symbol> <symbol id="icon-vimeo" viewBox="0 0 16 16"><g> <path d="M15.994 4.281c-.072 1.556-1.159 3.691-3.263 6.397-2.175 2.825-4.016 4.241-5.522 4.241-.931 0-1.722-.859-2.366-2.581-.431-1.578-.859-3.156-1.291-4.734-.478-1.722-.991-2.581-1.541-2.581-.119 0-.538.253-1.256.753l-.753-.969c.791-.694 1.569-1.388 2.334-2.081 1.053-.909 1.844-1.387 2.372-1.438 1.244-.119 2.013.731 2.3 2.553.309 1.966.525 3.188.647 3.666.359 1.631.753 2.447 1.184 2.447.334 0 .838-.528 1.509-1.588.669-1.056 1.028-1.862 1.078-2.416.097-.912-.262-1.372-1.078-1.372a2.98 2.98 0 0 0-1.184.263c.787-2.575 2.287-3.825 4.506-3.753 1.641.044 2.416 1.109 2.322 3.194z"/> </g></symbol> <symbol id="icon-wordpress" viewBox="0 0 16 16"><g> <path d="M2 8c0 2.313 1.38 4.312 3.382 5.259L2.52 5.622A5.693 5.693 0 0 0 2 8zm10.05-.295c0-.722-.266-1.222-.495-1.612-.304-.482-.589-.889-.589-1.371 0-.537.418-1.037 1.008-1.037.027 0 .052.003.078.005A6.064 6.064 0 0 0 8 2.156 6.036 6.036 0 0 0 2.987 4.79c.141.004.274.007.386.007.627 0 1.599-.074 1.599-.074.323-.018.361.444.038.482 0 0-.325.037-.687.055l2.185 6.33 1.313-3.835-.935-2.495a12.304 12.304 0 0 1-.629-.055c-.323-.019-.285-.5.038-.482 0 0 .991.074 1.58.074.627 0 1.599-.074 1.599-.074.323-.018.362.444.038.482 0 0-.326.037-.687.055l2.168 6.282.599-1.947c.259-.809.457-1.389.457-1.889zm-3.945.806l-1.8 5.095a6.148 6.148 0 0 0 3.687-.093.52.52 0 0 1-.043-.081L8.105 8.511zm5.16-3.315c.026.186.04.386.04.601 0 .593-.114 1.259-.456 2.093l-1.833 5.16c1.784-1.013 2.983-2.895 2.983-5.051a5.697 5.697 0 0 0-.735-2.803zM8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm0 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14z"/> </g></symbol> <symbol id="icon-youtube" viewBox="0 0 16 16"><g> <path d="M15.841 4.8s-.156-1.103-.637-1.587c-.609-.637-1.291-.641-1.603-.678-2.237-.163-5.597-.163-5.597-.163h-.006s-3.359 0-5.597.163c-.313.038-.994.041-1.603.678C.317 3.697.164 4.8.164 4.8S.005 6.094.005 7.391v1.213c0 1.294.159 2.591.159 2.591s.156 1.103.634 1.588c.609.637 1.409.616 1.766.684 1.281.122 5.441.159 5.441.159s3.363-.006 5.6-.166c.313-.037.994-.041 1.603-.678.481-.484.637-1.588.637-1.588s.159-1.294.159-2.591V7.39c-.003-1.294-.162-2.591-.162-2.591zm-9.494 5.275V5.578l4.322 2.256-4.322 2.241z"/> </g></symbol></svg>
  <header class="l-header">
    
    <p class="c-title p-title"><a href="https://www.hhyu.org/" class="p-title__link">Cortically Magnified</a></p>
    
    
    <p class="p-subtitle">
      Science, programming, books, and other interesting stuff
    </p>
    
  </header>

  <main id="main" class="l-main">


<article class="p-article h-entry">
  <header>
    <h1 class="p-name">How this website was built - a tutorial</h1>
    <div>
      
        <div class="c-time">
          Posted on
<a class="u-url" href="https://www.hhyu.org/posts/website_tutorial/">
<time class="dt-published" datetime="2020-12-17T00:00:00Z">
  Dec 17, 2020
</time>
</a>

        </div>
      
      
      <a href="https://www.hhyu.org/tags/tutorial" class="c-tag">tutorial</a>
      
      <a href="https://www.hhyu.org/tags/hugo" class="c-tag">hugo</a>
      
      <a href="https://www.hhyu.org/tags/golang" class="c-tag">golang</a>
      
      <a href="https://www.hhyu.org/tags/aws" class="c-tag">aws</a>
      
    </div>
  </header>
  
  <section id="js-article" class="p-article__body e-content">
    <p>I started this website in 2018, because I wanted to collect all my content in one single place. I decided to built it with simple tools, so I could understand how everything works, and fix problems if needed. It&rsquo;s a hobby like how some people like to build their own kitchens. Lots of tutorials are available on building personal websites, but I still want to write my own, because when I got started, I could never find one that explained every step needed to build a complete website. The problem was not that I couldn&rsquo;t find information about how to perform certain technical steps. The problem was that I wasn&rsquo;t sure which steps were relevant. So I will document everything I have done for this site, and I hope that it could be helpful for those who want to hand-build their own sites.</p>
<h3 id="static-website-generation-with-hugohttpsgohugoio">Static website generation with <a href="https://gohugo.io">Hugo</a></h3>
<p>The easiest way to make a website is to use a static website generator. The way it works is that you provide a folder of documents written in <a href="https://www.markdownguide.org">Markdown</a>, and the generator makes a website for you, based on the theme that you choose. The generated website is just a bunch of HTML, css, and javascript files. There are no content management systems and no databases. For the simple website that I have in mind, this is  more than enough. But of course, it means that it&rsquo;s harder to include fancy features such as webstores, discussion forums, and other forms of interactivity. For that kind of thing, you are probably better off with dynamic solutions such as WordPress or SquareSpace.</p>
<p>There are many static website generators to choose from. In fact, the number is growing so fast that it&rsquo;s hard to keep track of them. I picked <a href="https://gohugo.io">Hugo</a> because it&rsquo;s easy to understand and easy to customize. It&rsquo;s written in the <a href="https://golang.org">Go programming language</a>, which tends to encourage minimalist design. One feature that I found very attractive is that although Hugo doesn&rsquo;t use a content management system, it is very flexible in content organization. In addition to the traditional organization tools such as tags and categories, you can also define your own taxonomy, which can be used to implement database-like features.</p>
<p>Simple websites are easy to build with Hugo. The only tricky part is that Hugo doesn&rsquo;t have a GUI or web-based interface, so you have to interact with it using the unix shell. As long as you are comfortable with the command line, it takes very little time and effort to get something basic running. The most important thing is to pick a theme. I picked a minimalist theme called <a href="https://themes.gohugo.io/hugo_theme_pickles/">Pickles</a> and never look back, but there are many <a href="https://themes.gohugo.io">options</a>.</p>
<p>The Pickles theme, like many other Hugo themes, supports the display of LaTeX equations using the <a href="https://katex.org">KaTex</a> fast rendering engine. The instructions, however, are hidden in the theme&rsquo;s demo page (<a href="https://themes.gohugo.io//theme/hugo_theme_pickles/post/math-typesetting/">here</a>) so you have to look carefully.</p>
<p>The only thing that I find lacking in Hugo so far is the presentation of images and image galleries. I use a package called <a href="https://github.com/liwenyip/hugo-easy-gallery">Hugo Easy Gallery</a>, but I haven&rsquo;t customize it enough to make images look nice. This requires some more work.</p>
<h3 id="tweaking-the-hugo-theme-to-support-two-blogging-formats">Tweaking the Hugo theme to support two blogging formats</h3>
<p>I wanted a website that has two sections: a <a href="https://hhyu.org">regular blog</a> for essays, and a <a href="https://hhyu.org/micro">microblog</a> for informal notes. Many people like to have a section of tweet-like short content. But for me, microblog entries are not necessarily shorter. Rather, they are different from regular blog entries because they don&rsquo;t have titles. If I can come up with a title for something I write, it means that it&rsquo;s an article written to communicate an idea to an audience. It&rsquo;s displayed with the title and a short blorb, which invite the readers to dig further. But if I can&rsquo;t come up with a title, it means that it&rsquo;s unorganized thought, written mostly for myself. It&rsquo;s displayed without a title, without tags, and in entirety. It&rsquo;s intended to be read as a person journal or a <a href="https://en.wikipedia.org/wiki/Commonplace_book">commonplace book</a>.</p>
<p>Most Hugo themes don&rsquo;t have a microblog section, so I had to modify the Pickles theme. This requires understanding how Hugo organizes its content, and how the template system works. Hugo&rsquo;s template system is derived from the template library of the Go programming language. They can embed programming logic, which make them very powerful, but it also means there is a learning curve. I couldn&rsquo;t find a tutorial that explained the general idea to me, until I found a book called <em>Build Websites with Hugo</em> by Brian Hogan. It&rsquo;s a little book that explains how to design a Hugo theme from scratch. Once I understood the logic behind the Hugo template system, it was surprisingly easy to tweak the Pickles theme to support the microblog format.</p>
<p>In short, a Hugo website can have multiple &ldquo;sections&rdquo;, which correspond to directories in the <code>content/</code> directory. I have a <code>posts/</code> directory for the regular blog, and a <code>micro/</code> directory for the microblog. When the website is generated by Hugo, content in the former directory is displayed under <code>hhyu.org/posts</code>, whereas content in the latter is displayed under <code>hhyu.org/micro</code>. All I had to do was to give these two sections different HTML templates. It is accomplished by adding a new template file called <code>section.html</code> under <code>themes/pickles_modified/layouts/_default/</code>. This is what&rsquo;s in the file:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">{{ <span style="color:#a2f;font-weight:bold">if</span> eq .Section <span style="color:#b44">&#34;posts&#34;</span> }}
    {{ .Render <span style="color:#b44">&#34;list&#34;</span> }}
{{ <span style="color:#a2f;font-weight:bold">else</span> <span style="color:#a2f;font-weight:bold">if</span> eq .Section <span style="color:#b44">&#34;micro&#34;</span> }}
    {{ .Render <span style="color:#b44">&#34;list_micro&#34;</span> }}
{{ end }}
</code></pre></div><p>It&rsquo;s easy to understand. If the reader requests <code>hhyu.org/posts</code>, use the <code>list.html</code> template; but if the reader requests <code>hhyu.org/micro</code>, use the <code>list_micro.html</code> template instead. <code>list.html</code> is part of the Pickles theme. I just had to modify it, and save it as <code>list_micro.html</code>.</p>
<p>The first time I tried to implement this idea in 2008, I decided not to modify the Pickles theme directly. Instead, I overrode some of Pickles' behaviors by saving my own templates under the <code>layout/</code> directory of my website&rsquo;s source code. After a while, I realized that it was easier for me to create my own version of the Pickles theme. This was done by <em>forking</em> Pickles source code on GitHub. My forked version of the theme can be found <a href="https://github.com/hsinhaoyu/hugo_theme_pickles">here</a> on GitHub.</p>
<h3 id="hosting-static-websites-on-aws-s3httpsawsamazoncoms3">Hosting static websites on AWS <a href="https://aws.amazon.com/s3/">S3</a></h3>
<p>The next question: How do we show the Hugo generated website to other people? Hosting HTML files is one of the most basic web services, which can be done in numerous ways. I decided to use S3, the cloud object storage service of AWS. It&rsquo;s an overkill for my needs, but it&rsquo;s cheap, widely used, and well integrated with AWS' other services.</p>
<p>Hosting on S3 is simple: you first create a storage space called a &ldquo;bucket&rdquo;, upload the Hugo-generated files into the bucket, and then make the bucket accessible to everybody. You can follow <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">this document</a>.</p>
<p>Since I need to upload to S3 every time I update my website, it&rsquo;s worthy to do it from the command line instead of the web-based AWS console. For that, I downloaded the <a href="https://aws.amazon.com/cli/">AWS command line interface</a>. After configuring it with my login information and the bucket&rsquo;s location, I can synchronize Hugo&rsquo;s generated website with the S3 bucket using a simple <code>sync</code> command.</p>
<p>If you are new to AWS, this might be a good time to familiarize yourself with AWS&rsquo;s <a href="https://aws.amazon.com/iam/">IAM</a> (Identity and Access Management) service. In short, when you create an account on AWS, that account is the root user account, which allows you unlimited control of your AWS services. It&rsquo;s good practice to create an additional IAM &ldquo;role&rdquo; and log in as an IAM user. It&rsquo;s safer than logging in as the root user.</p>
<h3 id="getting-a-custom-domain-name">Getting a custom domain name</h3>
<p>The problem with hosting on S3 was that the website had to be accessed via a web address (i.e., URL) provided by the S3 server. I wanted it to be something simpler and personal. For that, I bought my domain name <code>hhyu.org</code> from <a href="https://www.hover.com">hover.com</a> - one of the more popular registrars, but there are many options to choose from. One noteworthy point is that although I said that I &ldquo;bought&rdquo; my domain name, I don&rsquo;t actually own it. It&rsquo;s more like a lease, so I have to renew my domain name every year.</p>
<p>Owning a domain name sounded like a big deal to me in th beginning. I didn&rsquo;t look into building my own site for many years, because I thought that only professional web developers deal with registrars. But in reality, it&rsquo;s very simple. I logged on to my registrar, and told it to forward all &ldquo;<a href="http://www.hhyu.org">http://www.hhyu.org</a>&rdquo; traffic to the address assigned to my bucket by AWS. That&rsquo;s it. An interesting thing that I didn&rsquo;t know when I started was that <a href="http://www.hhyu.org">http://www.hhyu.org</a> and <a href="http://hhyu.org">http://hhyu.org</a> are two separate addresses, so I had to tell hover.com to forward both to AWS. I thought that <code>hhyu.org</code> was an abbreviated form, which is translated to the full name <code>www.hhyu.org</code> by the browser.</p>
<h3 id="directing-traffic-to-my-domain-with-aws-route-53httpsawsamazoncomroute53">Directing traffic to my domain with <a href="https://aws.amazon.com/route53/">AWS Route 53</a></h3>
<p>With forwarding, people could visit my website with my domain name <code>http://hhyu.org</code>, but the address displayed on their browser was still the AWS address. That seemed wrong to me. I don&rsquo;t want my readers to feel that they started at <code>hhyu.org</code> but were transported to a different place. In other words, what I wanted was &ldquo;address masking&rdquo; rather than &ldquo;forwarding&rdquo;.</p>
<p>There are different ways to achieve this goal, but since I use AWS S3 for hosting, I decided to use another AWS service called Route 53. The process is a little technical, involving editing something called DNS records, but it was just a matter of filling up some forms. I followed the instructions of <a href="https://aaronshaver.medium.com/setup-a-custom-domain-on-aws-using-s3-static-website-hosting-and-route-53-1b30eda0d4c1">this tutorial</a>. What got me stuck for a while was I didn&rsquo;t understand the logic behind it. The basic idea is this: DNS (Domain Name Service) is the mechanism for translating domain names such as <code>hhyu.org</code> to the server on the Internet. My registrar&rsquo;s DNS only does forwarding, but I can tell it to use Route 53 instead. Once I allowed Route 53 to provide the DNS service, it can make it look like my website and my domain name are one and the same.</p>
<h3 id="securing-content-distribution-with-aws-cloudfronthttpsawsamazoncomcloudfront">Securing content distribution with <a href="https://aws.amazon.com/cloudfront/">AWS CloudFront</a></h3>
<p>The S3 hosting service is convenient, but it serves the web pages with the HTML protocol. It&rsquo;s an unencrypted protocol that can easily be exploited. To increase the security of my site, I&rsquo;d like to use the HTTPS protocol instead. Within the AWS ecosystem, this can be done with CloudFront. I followed this <a href="https://www.davidbaumgold.com/tutorials/host-static-site-aws-s3-cloudfront/">tutorial</a>. There are two major steps: First, I had to create a &ldquo;distribution&rdquo; of my bucket. This way, the content of my site is send to AWS servers all over the world, to reduce load time. Second, I needed an ACM security certificate to distribute the distribution using the encrypted HTTPS protocol. Getting a certificate sounded like a difficult process, but it really was just a matter of sending a request on AWS. It was granted in less than an hour. One problem that I encountered was that I didn&rsquo;t know that I had to switch my region to North Virginia when I requested a certificate.</p>
<p>Big distribution networks like CloudFront move slowly, which means that after I update the content of the  bucket, it can take several hours to a full day for CloudFront to update my distribution. This isn&rsquo;t a big issue for simple websites like mine, but it is possible to <em>invalidate</em> the distribution, to force CloudFront to update it. Invalidation can be initiated with CloudFront&rsquo;s web-based console, or with the <code>create-invalidation</code> command in the AWS commandline tool.</p>
<h3 id="building-a-deployment-pipeline-with-github-actionshttpsgithubcomfeaturesactions">Building a deployment pipeline with <a href="https://github.com/features/actions">GitHub Actions</a></h3>
<p>At this stage, I have to manually use Hugo to generate the website, and sync the new website to S3 from the command line. This process is not very tedious, but I still wanted to automate it. For a casual blogger like me, reducing the friction in blogging is important to keep me going. Hugo has its own <a href="https://gohugo.io/hosting-and-deployment/">deployment mechanism</a>, but I decided to use GitHub as the mechanism for deployment. The rationale will become more obvious in the next section.</p>
<p><a href="https://www.github.com">GitHub</a> is a cloud service for programmers to share their source code. To maintain a copy of my website&rsquo;s source code on GitHub, I use a version-control system called <a href="https://en.wikipedia.org/wiki/Git">git</a> to track the changes made to my website. Once I am happy with a new edition of my website (which is typically after I add a new post), I can &ldquo;commit&rdquo; the edits and then &ldquo;push&rdquo; the source code to GitHub. Git is a very complicated program that takes time to learn, but the advantage is enormous: First, I always have the source code of my website backed-up in a  GitHub <em>repository</em>. Second, git maintains the entire history of my website, so I can checkout past editions of the website easily if needed. Third, thank to the branching feature of <code>git</code>, it&rsquo;s safe to tinker. If I want to add a new feature to my site, I can create a parallel universe of the site called a &ldquo;branch&rdquo;, and experiment in it as much as I want without affecting my website. When the new feature is ready, it can be &ldquo;merged&rdquo; into the main branch of the source code. If the new feature doesn&rsquo;t work as planned, nobody will see it. And fourth, <code>GitHub</code> opens the door to automation.</p>
<p>The key to building a deployment pipeline around GitHub is a software engineering concept called Continuous Integration (CI). What it means is that once a new version of a piece of software is finalized, an automated process should check for bugs, and prepare it for deployment. For our purpose, it means that that once the source code of a new version of the website is sync&rsquo;ed to GitHub, a script will automatically regenerate the website with Hugo, and deploy it to AWS. <a href="https://travis-ci.com">Travis-CI</a> is a popular third-party service that can integrate with GitHub, but I decided to try GitHub&rsquo;s own automation tool called Actions. Because all the necessary actions have already been developed by the GitHub community, it was very easy for me to glue them together. <a href="https://github.com/hsinhaoyu/hhyu_site/blob/master/.github/workflows/main.yml">This</a> is the script that I am using. It resides in the <code>.github/workflows</code> directory under my site&rsquo;s root directory. The script generates the website, syncs with S3, invalidates the Cloudfront distribution, and sends me a Slack message on to tell me that it&rsquo;s all done. I can openly share this script with you, because all authentication information is encrypted in GitHub as <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets">repository secrets</a>, so they don&rsquo;t have to be revealed in the script.</p>
<p>With this setup, after writing a new blog post, all I have to do is to sync with GitHub. GitHub Actions takes care of the rest.</p>
<h3 id="posting-on-the-go-with-a-mobile-github-client">Posting on the go with a mobile GitHub client</h3>
<p>I don&rsquo;t have a lot of opportunities to blog from my laptop (such is the life of a dad with a young child), so I really needed a way to blog from my phone. The problem was that Hugo doesn&rsquo;t run on phones. For a long time, I thought that there was no way to solve this problem&hellip; until I found <a href="http://evanbrown.io/post/hugo-on-the-go/">this article</a>. Since Hugo is now running on GitHub rather than my laptop, all I have to do is to use a GitHub client for the phone to post to my website. I use a program called <a href="https://workingcopyapp.com/">Working Copy</a> for the iOS. It&rsquo;s a little expensive, but it&rsquo;s a very well developed app. I can create a new Markdown file in the <code>content/</code> directory of my website&rsquo;s repository, commit the changes, and push to GitHub, and then the website will be regenerated and deployed.</p>
<p>Note that since I still use my laptop to update my website, it&rsquo;s important to make sure GitHub Actions uses the same version of Hugo that I use on my laptop.</p>
<h3 id="improving-the-blogging-experience-with-micropubhttpsindieweborgmicropub">Improving the blogging experience with <a href="https://indieweb.org/Micropub">Micropub</a></h3>
<p>The solution above does work, but GitHub is, after all, a programmers' tool rather a blogging tool. The interface is a bit unnatural for blogging. For a better experience, I turned to <a href="https://indieweb.org/Micropub">Micropub</a> - a W3C recommended open standard for posting entries to websites. Since Micropub is an open protocol, a variety of Micropub client programs have been developed to post to any website that accepts the Micropub protocol. I decided to use <a href="https://quill.p3k.io">Quill</a>, a popular web-based client, although <a href="https://indieweb.org/Micropub/Clients">other options</a> are available. Below are the steps that I took for my site to work with Micropub clients.</p>
<p>I think it&rsquo;s worthy to point out here that Micropub is part of a larger movement called <a href="https://indieweb.org">IndieWeb</a>. IndieWeb is an alternative approach to social networking. In contrast to corporate-owned services such as Facebook or Twitter, IndieWeb websites are owned by individuals, and they interact with each other using open protocols. It is an exciting movement that deserves a more in-depth discussion (you can start <a href="https://www.smashingmagazine.com/2020/08/autonomy-online-indieweb/">here</a>), but for the purpose for this tutorial, I will concentrate on blogging with Micropub. The IndieWeb community has developed many components that can work with static websites, so it&rsquo;s a great source of inspiration for me. I plan to dive deeper into IndieWeb in the future.</p>
<h3 id="configuring-an-indieauthhttpsindieweborgindieauth-endpoint-for-authentication">Configuring an <a href="https://indieweb.org/IndieAuth">IndieAuth</a> endpoint for authentication</h3>
<p>To blog from a Micropub client program such as Quill, the first issue was to tell the program who I was. I thought I had to create an account on Quill, but the IndieWeb world has its own way of doings things. When I got started, I thought that IndieWeb&rsquo;s protocol for establishing identity, called <a href="https://indieweb.org/IndieAuth">IndieAuth</a>, was confusing, but it makes lots of sense after I got used to it.</p>
<p>The central philosophy is that my identity on the web should belong to me. Web services should come to my site for all information about me. I shouldn&rsquo;t need to create different accounts for different social networks, and I shouldn&rsquo;t need to use their methods to authenticate myself. This means that to log in to an IndieWeb-based service, the only information that I need to provide is the address of my website. From my website, the service can extract the address of an <em>authorization endpoint</em>. The service then negotiates with my authorization endpoint to establish my identity.</p>
<p>In theory, this authorization endpoint should be a server program that I write myself to implements <em>my</em> policies. For example, if somebody uses my website to log in to Quill, my authorization endpoint might ask for a password, or even a retinal scan. It can be anything that I consider sufficient to identify myself. But of course, I didn&rsquo;t actually have to implement one myself, because the community has done the hard work. For example, <a href="https://indieauth.com">IndieAuth.com</a> is a popular authorization endpoint. The way it works is that I can ask IndieAuth.com to go to one of the web services that I already use to authenticate me. Since I use GitHub a lot, I asked IndieAuth.com to delegate authorization to GitHub. If I can convince GitHub that I am the person who I claim to be, IndieAuth.com will also report to any service that I am that guy. Note that IndieAuth.com is one particular implementation of the IndieAuth protocol. The protocol itself is more general.</p>
<p><a href="https://indieauth.com/setup">This</a> is the instructions for setting up for IndieAuth.com. I also found <a href="https://www.amitgawande.com/2018/02/10/204300.html">this tutorial</a> useful. First, on my site where I link to my GitHub account, I added the <code>rel=me</code> attribute to the <code>&lt;a&gt;</code> tag to confirm to GitHub that <code>https://hhyu.org</code> is my site. For the theme that I am using, I had to edit the <code>layouts/partials/links.html</code> template, so that in the generated HTML, the link to GitHub looks like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"> &lt;<span style="color:#008000;font-weight:bold">a</span> <span style="color:#b44">href</span><span style="color:#666">=</span><span style="color:#b44">https://github.com/hsinhaoyu</span> <span style="color:#b44">target</span><span style="color:#666">=</span><span style="color:#b44">_blank</span> <span style="color:#b44">rel</span><span style="color:#666">=</span><span style="color:#b44">me</span>&gt;
</code></pre></div><p>Second, I added the followings to the <code>&lt;head&gt;</code> section of my site. For the theme that I use, I had to create the <code>layouts/partials/head_custom.html</code> template, but it depends on how the theme is implemented.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#008000;font-weight:bold">link</span> <span style="color:#b44">rel</span><span style="color:#666">=</span><span style="color:#b44">&#34;authorization_endpoint&#34;</span> <span style="color:#b44">href</span><span style="color:#666">=</span><span style="color:#b44">&#34;https://indieauth.com/auth&#34;</span>&gt;
&lt;<span style="color:#008000;font-weight:bold">link</span> <span style="color:#b44">rel</span><span style="color:#666">=</span><span style="color:#b44">&#34;token_endpoint&#34;</span> <span style="color:#b44">href</span><span style="color:#666">=</span><span style="color:#b44">&#34;https://tokens.indieauth.com/token&#34;</span>&gt;
&lt;<span style="color:#008000;font-weight:bold">link</span> <span style="color:#b44">rel</span><span style="color:#666">=</span><span style="color:#b44">&#34;micropub&#34;</span> <span style="color:#b44">href</span><span style="color:#666">=</span><span style="color:#b44">&#34;https://xxxx.execute-api.ap-southeast-2.amazonaws.com/Prod/&#34;</span>&gt;
</code></pre></div><p>The first tag declares that I opt to use IndieAuth.com to be my authorization endpoint. The second tag declares a second authentication-related service that will be explained in a later section. With these two tags, I can already log on to a number of IndieWeb services without creating separate accounts. For example, I can use the <a href="https://indieweb.org">IndieWeb wiki</a> to participate in community discussions, and <a href="https://indiebookclub.biz">IndieBookClub</a> to keep track of the books that I am reading. That&rsquo;s pretty cool, but it&rsquo;s not enough for Micropub clients such as Quill, because the Micropub endpoint, declared in the third tag, had not been implemented yet. We&rsquo;ll deal with that in the following sections.</p>
<p>A side note: so far, I am identified to the IndieWeb world as <code>https://hhyu.org</code>, the URL of my site. For social networking, that seems a bit too impersonal. It would be better if I could associate it with my name and perhaps other personal information, so that they can be extracted and displayed by IndieWeb services. The mechanism is called <a href="https://indieweb.org/h-card"><code>h-card</code></a>, which allows a wide range of personal information to be tagged. My h-card is minimal. I edited the footer template (<code>layouts/partials/footer.html</code>) so that my name is in the h-card:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#008000;font-weight:bold">a</span> <span style="color:#b44">class</span><span style="color:#666">=</span><span style="color:#b44">&#34;h-card&#34;</span> <span style="color:#b44">href</span><span style="color:#666">=</span><span style="color:#b44">&#34;https://hhyu.org&#34;</span>&gt;Hsin-Hao Yu&lt;/<span style="color:#008000;font-weight:bold">a</span>&gt;
</code></pre></div><p><a href="https://indiewebify.me">indiewebify</a> is a very useful tool for (among many things) checking if the <code>h-card</code> information is tagged correctly.</p>
<h3 id="customizing-a-micropub-server-for-aws-lambdahttpsawsamazoncomlambda">Customizing a Micropub server for <a href="https://aws.amazon.com/lambda/">AWS Lambda</a></h3>
<p>We took a detour to IndieAuth. Let&rsquo;s return to the problem at hand. The goal is to create a pipeline such that after I finish writing a new blog post using a Micropub client, it sends the new post to a Micropub endpoint (specified by the <code>&lt;link rel=&quot;micropub&quot;...&gt;</code> tag discussed previously). The server program at the endpoint commits the post to the GitHub repository, and GitHub Actions will generate the website, and deploy it to AWS.</p>
<p>I had no prior experience in programming or setting up servers, so implementing this idea was a little intimidating to me. Luckily, the IndieWeb community has developed several Microbpub servers, so I didn&rsquo;t have to write one from scratch. I started with Cole Lyman&rsquo;s <a href="https://github.com/Colelyman/gozette">gozette</a> because the source code (written in Go) is concise and easy to understand. In addition, it&rsquo;s designed to be deployed on <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> - a &ldquo;serverless application service&rdquo; which takes away some of the hurdles associated with server programming. In this setup, AWS handles the interface to the web. All we have to do is provide a function (which is called a &ldquo;lambda&rdquo; in programming) to interpret the incoming requests and acts on them. More concretely, when AWS receives a request to post from my Micropub client, it sends the post to <code>gozette</code>, which commits it to GitHub. <code>gozette</code> merely functions as a bridge between AWS&rsquo;s web gateway and GitHub. This is why the code is so lightweight.</p>
<p>I forked <code>gozette</code>&rsquo;s repository on GitHub so I could have a <a href="https://github.com/hsinhaoyu/gozette-hhyu">personalized copy</a>. I  customized the code slightly for my particular setup:</p>
<ol>
<li>The file <code>validation.go</code> is all about authentication with IndieAuth.com. I assigned the constant <code>indieAuthMe</code> to the URL of my site <code>https://hhyu.org</code>.</li>
<li>The file <code>github.go</code> interfaces with GitHub. I assigned variables <code>sourceOwner</code>, <code>authorName</code>, <code>authorEmail</code> and <code>sourceRepo</code> my own information. The most important one is <code>sourceRepo</code>. It is the name of the GitHub repository of my website.</li>
<li>The original <code>gozette</code> commits a new post to the <code>site/content/micro/</code> directory in the GitHub repository, but I needed it to be committed to <code>content/micro/</code>. This can be changed by modifying the <code>WriteHugoPost()</code> function in <code>post.go</code>.</li>
<li>Since <code>gozette</code> will modify my GitHub repository, it needs a key (called a <em>token</em>) to communicate with GitHub. I went to <code>Personal Settings</code> of my GitHub profile, and used <code>Developer settings &gt; Personal access tokens</code> to generate a token. It&rsquo;s a string of random numbers and letters. I added the section below to <code>template.yaml</code>. When <code>gozette</code> is running on AWS Lambda, this is how it convinces GitHub that it is acting on my behalf.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">Environment</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Variables</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">GIT_API_TOKEN</span>:<span style="color:#bbb"> </span>&lt;insert token here&gt;<span style="color:#bbb">
</span></code></pre></div><p>There is how to work with my version of <code>gozette</code>:</p>
<ol>
<li>Clone the <a href="https://github.com/hsinhaoyu/gozette-hhyu">repository</a>  under <code>~/go/src/</code>. The Go compiler does care about where the source is located, so I recommend that you don&rsquo;t put it anywhere else.</li>
<li>Download the dependent libraries using the <code>go get</code> command. You have to issue these command under <code>~/go/src/gozette-hhyu/</code>.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go get github.com/speps/go-hashids
go get golang.org/x/oauth2
go get github.com/aws/aws-lambda-go/events
go get github.com/aws/aws-lambda-go/lambda
go get github.com/google/go-github/github
</code></pre></div><ol start="3">
<li>Modify the source code if needed.</li>
<li>Compile the code. Under <code>~/go/src/gozette-hhyu/</code>, issue the following commands:</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go mod init gozette/main
go install ./gozette
</code></pre></div><p>If you don&rsquo;t see any error message, <code>gozette</code> is ready to run on AWS Lambda.</p>
<h3 id="testing-the-micropub-server-locally-with-samhttpsdocsawsamazoncomserverless-application-modellatestdeveloperguideserverless-sam-referencehtmlserverless-sam-cli">Testing the Micropub server locally with <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-reference.html#serverless-sam-cli">SAM</a></h3>
<p>Before I uploaded <code>gozette</code> to AWS Lambda, I wanted to make sure that it ran correctly on my own laptop. The good news is that AWS provides a tool called <a href="https://aws.amazon.com/blogs/aws/new-aws-sam-local-beta-build-and-test-serverless-applications-locally/">SAM</a> for this purpose. When I first started to try SAM, I was a little intimidated by its complexity. I decided to first try a simple &ldquo;Hello World&rdquo; example. In <code>~/go/src/</code>, I asked SAM to create a demo project in Go with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sam init --runtime go1.x --name sam-go
</code></pre></div><p>I followed the instructions in README.md, and made sure that I knew enough to deploy a simple function to AWS Lambda.</p>
<p>Now go back to <code>~/go/src/gozette-hhyu/</code>. We can start the server locally with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sam build
sam <span style="color:#a2f">local</span> start-api
</code></pre></div><p>As soon as the server is started, a local IP address (such as <code>http://127.0.0.1:3000/</code>) is provided by SAM. That is the address of the endpoint.</p>
<p>I needed a way to talk to it. Instead of using an actual Micropub client, I found it easier to use a utility program called <a href="https://curl.se"><code>curl</code></a>.</p>
<p>To make it work, we need to know more about the authentication process. As discussed above, I can log in to a Micropub client (e.g., Quill) using the authorization endpoint IndieAuth.com. The question is: how does the Micropub endpoint (e.g., <code>gozette</code>) know that the client is actually acting on my behave? What happens if another person tries to post to my Micropub endpoint? The answer is that after successful authentication, the client passes an &ldquo;access token&rdquo; to the Micropub endpoint. Importantly, the client doesn&rsquo;t generate this token itself. Instead, it delegates the job to another endpoint, called the <a href="https://indieweb.org/token-endpoint">token endpoint</a>. When the Micropub endpoint receives the access token, it contacts the token endpoint to verify that the token is valid. The HTML code provided above shows that I opt to use <code>https://tokens.indieauth.com/token</code> to be my token endpoint, although other options are also available. Note that in this setup, the Micropub endpoint doesn&rsquo;t need to know about the authorization endpoint. This is why in <code>gozette</code>&rsquo;s source code, there is no reference to the authorization endpoint, but I had to provide the token endpoint.</p>
<p>To communicate to the locally running <code>gozette</code> with <code>curl</code>, an access token is needed. It&rsquo;s not trivial to find it, because it&rsquo;s not normally exposed to the end-user. Luckily, Sebastiaan Andeweg&rsquo;s <a href="https://gimme-a-token.5eb.nl">Gimme an Access Token webapp</a> provides this function. After obtaining a token, I could request <code>gozette</code> to commit a new post to GitHub with the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>-X POST <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>-H <span style="color:#b44">&#34;Content-Type: application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>-H <span style="color:#b44">&#34;Authorization: Bearer XXXX&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>-d <span style="color:#b44">&#39;{&#34;content&#34;:&#34;hello world&#34;,&#34;name&#34;:&#34;new post&#34;, &#34;category&#34;: [&#34;tag1&#34;, &#34;tag2&#34;], &#34;mp-slug&#34;: &#34;first_post&#34;}&#39;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>http://127.0.0.1:3000/
</code></pre></div><p>Remember to replace <code>XXXX</code> with the access token, and <code>http://127.0.0.1:3000/</code> with the address returned from SAM. If you see a new file called <code>content/micro/first_post.md</code> in your GitHub repository, it means that <code>gozette</code> is ready to be uploaded to AWS Lambda. During debugging and testing, I made <code>gozette</code> commit to a test repository, rather than the repository of my Hugo site.</p>
<h3 id="running-the-micropub-server-on-aws-lambda">Running the Micropub server on AWS Lambda</h3>
<p>Now it&rsquo;s time to deploy <code>gozette</code> to AWS Lambda. Under <code>~/go/src/gozette-hhyu/</code>, run</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sam deploy --guided
</code></pre></div><p>If everything works, SAM will return an &ldquo;API Gateway endpoint URL&rdquo;. This is the AWS address that <code>gozette</code> will receive requests from. For example, I received <code>https://xxxxx.execute-api.ap-southeast-2.amazonaws.com/Prod/</code> (remember that this was the URL that I assigned to the <code>&lt;link rel=&quot;micropub&quot;&gt;</code> tag in the <code>&lt;head&gt;</code> section.). I tested it with the same <code>curl</code> command above, except that I replaced the local address with the AWS endpoint address, and I verified that a new file was committed to GitHub. So <code>gozette</code> is now running correctly on AWS Lambda.</p>
<p>I had planned to redirect <code>hhyu.org/micropub</code> to the AWS API gateway URL. This can be done with S3&rsquo;s redirection rule, but this approach didn&rsquo;t seem to work with CloudFront.</p>

  </section>
  <footer>
    
    <nav class="p-pagination c-pagination">
      <div class="c-pagination__ctrl">
        <div class="c-pagination__newer">
          
          <a href="https://www.hhyu.org/posts/literate_config/">Newer</a>
          
        </div>
        <div class="c-pagination__older">
          
          <a href="https://www.hhyu.org/posts/emacs_clientserver/">Older</a>
          
        </div>
      </div>
    </nav>
    
    
<aside class="p-author">
  
  <div class="c-avatar p-author__avatar">
    <img alt="Author Avatar" src="/sitewide/logo.png" />
  </div>
  
  
  <div class="p-author__body">
    
    <p class="c-title p-author__name ">Hsin-Hao Yu</p>
    
    
    <p class="p-note">A Taiwanese scientist living in Melbourne</p>
    
    
    <p>
      <a href="mailto:hsinhaohh.yu@gmail.com">
        Contact me
      </a>
    </p>
    
  </div>
  
</aside>


  </footer>
</article>
  </main>
  
<nav class="l-nav p-menu">
  <ul class="p-menu__lists">
    
      
        <li class="p-menu__listitem p-menu__parent">
          <span>/About</span>
          <ul>
            
              <li class="p-menu__listitem p-menu__child"><a href="/about">Me</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/about_site">This site</a></li>
            
          </ul>
        </li>
      
    
      
        <li class="p-menu__listitem p-menu__parent">
          <span>/Science</span>
          <ul>
            
              <li class="p-menu__listitem p-menu__child"><a href="/research">Research</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/publications">CV and Publications</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/gallery">Visualization Gallery</a></li>
            
          </ul>
        </li>
      
    
      
        <li class="p-menu__listitem p-menu__parent">
          <span>/Updates</span>
          <ul>
            
              <li class="p-menu__listitem p-menu__child"><a href="/">Blog</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/micro/">Notes</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="https://github.com/hsinhaoyu/resources">Resources</a></li>
            
          </ul>
        </li>
      
    
      
      <li class="p-menu__listitem">
        <a href="/tags">Tags</a>
      </li>
      
    
  </ul>
</nav>


  <footer class="l-footer">
    
<ul class="c-links">
  
  
  <li class="c-links__item">
    <a href="https://twitter.com/HsinHaoYu" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>twitter</title>
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </li>
  
  
  
  <li class="c-links__item">
    <a href="https://instagram.com/hhyu00" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>instagram</title>
        <use xlink:href="#icon-instagram"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://github.com/hsinhaoyu" target="_blank" rel="me">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>github</title>
        <use xlink:href="#icon-github"></use>
      </svg>
    </a>
  </li>
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="c-links__item">
    <a href="https://linkedin.com/in/hsin-hao-yu-165387110" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>linkedin</title>
        <use xlink:href="#icon-linkedin"></use>
      </svg>
    </a>
  </li>
  
  
</ul>



    <p class="p-copyright">
      
        
          
            <a class="h-card" href="https://hhyu.org">Hsin-Hao Yu</a>
          
        
        &nbsp;&bull;&nbsp;
        2021

        
          &nbsp;&bull;&nbsp;
          <a href="https://www.hhyu.org/">Cortically Magnified</a>
        
      
    </p>
  </footer>

</body>
</html>

