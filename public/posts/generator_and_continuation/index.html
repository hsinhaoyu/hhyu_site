<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  
  <title>Beautiful ideas in programming: generators and continuations</title>
  <meta property="og:title" content="Beautiful ideas in programming: generators and continuations" />
  <meta name="twitter:title" content="Beautiful ideas in programming: generators and continuations" />
  

  
  <meta name="description" content="Science, programming, books, and other interesting stuff">
  <meta property="og:description" content="Science, programming, books, and other interesting stuff">
  <meta name="twitter:description" content="Science, programming, books, and other interesting stuff">
  

  <meta name="author" content="Hsin-Hao Yu"/>
  <meta property="og:site_name" content="Cortically Magnified" />
  <meta property="og:url" content="https://www.hhyu.org/posts/generator_and_continuation/" />

  
  <meta name="twitter:card" content="summary" />

  
  <meta name="twitter:site" content="@HsinHaoYu" />
  <meta name="twitter:creator" content="@HsinHaoYu" />
  

  
  <meta property="og:type" content="article" />
  
  
  
  <meta name="generator" content="Hugo 0.79.0" />
  
  

  <link rel="stylesheet" href="https://www.hhyu.org/css/style.css" />
  
  
  <link rel='icon' type='image/x-icon' href="https://www.hhyu.org/path/to/favicon" />
  

    
  
  <script type="text/javascript" src="https://www.hhyu.org/js/bundle.js"></script>
  <link rel="authorization_endpoint" href="https://indieauth.com/auth">
<link rel="token_endpoint" href="https://tokens.indieauth.com/token">
<link rel="micropub" href="https://lr85f9rofe.execute-api.ap-southeast-2.amazonaws.com/Prod/">
<link rel="microsub" href="https://aperture.p3k.io/microsub/592">
<link rel="webmention" href="https://webmention.io/hhyu.org/webmention" />
<link rel="pingback" href="https://webmention.io/hhyu.org/xmlrpc" />

</head>

<body>
  <a href="#main" class="skip-link p-screen-reader-text">Skip to content</a>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;" aria-hidden="true"> <symbol id="icon-500px" viewBox="0 0 16 16"><g> <path d="M3.953 10.512a5.24 5.24 0 0 0 6.996 3.141c.625-.262 1.184-.641 1.666-1.122s.859-1.041 1.122-1.666c.272-.647.412-1.331.412-2.037s-.137-1.394-.412-2.037c-.262-.625-.641-1.184-1.122-1.666s-1.041-.859-1.666-1.122a5.226 5.226 0 0 0-2.037-.413c-.716 0-1.431.144-2.066.413-.509.216-1.372.769-1.875 1.291l-.003.003V.984h7.241c.262-.003.262-.372.262-.491 0-.122 0-.487-.266-.491H4.377a.343.343 0 0 0-.344.341v6.066c0 .197.244.338.472.384.444.094.544-.047.653-.197l.016-.019c.166-.247.681-.766.688-.772a4.262 4.262 0 0 1 3.037-1.25c1.147 0 2.222.444 3.028 1.25a4.245 4.245 0 0 1 1.256 3.019 4.236 4.236 0 0 1-1.25 3.019 4.336 4.336 0 0 1-3.047 1.25 4.136 4.136 0 0 1-2.159-.597l.003-3.688c0-.491.213-1.028.572-1.431a2.09 2.09 0 0 1 1.588-.716c.594 0 1.15.225 1.566.634.409.406.637.95.637 1.528a2.179 2.179 0 0 1-2.206 2.197c-.238 0-.672-.106-.691-.109-.25-.075-.356.272-.391.387-.134.441.069.528.109.541.397.125.659.147 1.003.147a3.173 3.173 0 0 0 3.169-3.169c0-1.734-1.422-3.144-3.166-3.144-.856 0-1.659.328-2.263.919-.575.566-.903 1.319-.903 2.069v.019c-.003.094-.003 2.306-.006 3.031l-.003-.003c-.328-.363-.653-.919-.869-1.488-.084-.222-.275-.184-.534-.103-.125.034-.469.141-.391.394zm3.722-.865c0 .106.097.2.156.253l.019.019c.1.097.194.147.281.147a.181.181 0 0 0 .131-.05c.044-.041.537-.544.588-.591l.553.55c.05.056.106.088.172.088.088 0 .184-.053.284-.156.238-.244.119-.375.063-.438l-.559-.559.584-.588c.128-.137.016-.284-.097-.397-.162-.162-.322-.206-.422-.112l-.581.581-.588-.588a.16.16 0 0 0-.113-.047c-.078 0-.172.053-.275.156-.181.181-.219.306-.125.406l.588.584-.584.584c-.053.05-.078.103-.075.156zm1.278-7.931c-.938 0-1.938.191-2.669.506a.207.207 0 0 0-.134.181.753.753 0 0 0 .069.337c.047.116.166.425.4.334a6.689 6.689 0 0 1 2.334-.444 6.35 6.35 0 0 1 2.469.497c.622.263 1.206.644 1.844 1.194a.22.22 0 0 0 .147.059c.125 0 .244-.122.347-.237.169-.191.287-.35.119-.509a6.858 6.858 0 0 0-2.1-1.356 7.326 7.326 0 0 0-2.825-.563zM14.006 13.3c-.113-.113-.209-.178-.294-.203s-.162-.006-.222.053l-.056.056a6.32 6.32 0 0 1-6.938 1.356 6.336 6.336 0 0 1-2.013-1.356 6.046 6.046 0 0 1-1.356-2.012c-.288-.713-.381-1.247-.413-1.422-.003-.016-.006-.028-.006-.037-.041-.206-.231-.222-.503-.178-.112.019-.459.072-.428.319v.006a7.261 7.261 0 0 0 2.04 3.994 7.266 7.266 0 0 0 10.288 0l.059-.059c.069-.084.134-.225-.159-.516z"/> </g></symbol> <symbol id="icon-codepen" viewBox="0 0 16 16"><g> <path d="M14.777 5.751l-7-4.667a.5.5 0 0 0-.555 0l-7 4.667a.501.501 0 0 0-.223.416v4.667c0 .167.084.323.223.416l7 4.667a.5.5 0 0 0 .554 0l7-4.667a.501.501 0 0 0 .223-.416V6.167a.501.501 0 0 0-.223-.416zM7.5 10.232L4.901 8.5 7.5 6.768 10.099 8.5 7.5 10.232zM8 5.899V2.434l5.599 3.732L11 7.898l-3-2zm-1 0l-3 2-2.599-1.732L7 2.435V5.9zM3.099 8.5L1 9.899V7.101L3.099 8.5zM4 9.101l3 2v3.465l-5.599-3.732L4 9.102zm4 2l3-2 2.599 1.732L8 14.565V11.1zM11.901 8.5L14 7.101v2.798L11.901 8.5z"/> </g></symbol> <symbol id="icon-dribbble" viewBox="0 0 16 16"><g> <path d="M8 16c-4.412 0-8-3.588-8-8s3.587-8 8-8c4.412 0 8 3.587 8 8s-3.588 8-8 8zm6.747-6.906c-.234-.075-2.116-.634-4.256-.291a29.7 29.7 0 0 1 1.328 4.872 6.845 6.845 0 0 0 2.928-4.581zM10.669 14.3c-.103-.6-.497-2.688-1.456-5.181-.016.006-.031.009-.044.016-3.856 1.344-5.241 4.016-5.362 4.266a6.807 6.807 0 0 0 6.863.9zm-7.747-1.722c.156-.266 2.031-3.369 5.553-4.509a7.04 7.04 0 0 1 .269-.081 24.04 24.04 0 0 0-.553-1.159c-3.409 1.022-6.722.978-7.022.975-.003.069-.003.138-.003.209 0 1.753.666 3.356 1.756 4.566zM1.313 6.609c.306.003 3.122.016 6.319-.831a43.092 43.092 0 0 0-2.534-3.953 6.854 6.854 0 0 0-3.784 4.784zM6.4 1.366a36.612 36.612 0 0 1 2.55 4c2.431-.909 3.459-2.294 3.581-2.469A6.799 6.799 0 0 0 6.4 1.366zm6.891 2.325c-.144.194-1.291 1.663-3.816 2.694.159.325.313.656.453.991.05.119.1.234.147.353 2.275-.284 4.534.172 4.759.219a6.816 6.816 0 0 0-1.544-4.256z"/> </g></symbol> <symbol id="icon-facebook" viewBox="0 0 16 16"><g> <path d="M9.5 3H12V0H9.5C7.57 0 6 1.57 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.271.229-.5.5-.5z"/> </g></symbol> <symbol id="icon-feed" viewBox="0 0 16 16"><g> <path d="M2.13 11.733c-1.175 0-2.13.958-2.13 2.126 0 1.174.955 2.122 2.13 2.122a2.126 2.126 0 0 0 2.133-2.122 2.133 2.133 0 0 0-2.133-2.126zM.002 5.436v3.067c1.997 0 3.874.781 5.288 2.196a7.45 7.45 0 0 1 2.192 5.302h3.08c0-5.825-4.739-10.564-10.56-10.564zM.006 0v3.068C7.128 3.068 12.924 8.87 12.924 16H16C16 7.18 8.824 0 .006 0z"/> </g></symbol> <symbol id="icon-flickr" viewBox="0 0 16 16"><g> <path d="M0 8.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0zm9 0a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/> </g></symbol> <symbol id="icon-github" viewBox="0 0 16 16"><g> <path d="M8 .198a8 8 0 0 0-2.529 15.591c.4.074.547-.174.547-.385 0-.191-.008-.821-.011-1.489-2.226.484-2.695-.944-2.695-.944-.364-.925-.888-1.171-.888-1.171-.726-.497.055-.486.055-.486.803.056 1.226.824 1.226.824.714 1.223 1.872.869 2.328.665.072-.517.279-.87.508-1.07-1.777-.202-3.645-.888-3.645-3.954 0-.873.313-1.587.824-2.147-.083-.202-.357-1.015.077-2.117 0 0 .672-.215 2.201.82A7.672 7.672 0 0 1 8 4.066c.68.003 1.365.092 2.004.269 1.527-1.035 2.198-.82 2.198-.82.435 1.102.162 1.916.079 2.117.513.56.823 1.274.823 2.147 0 3.073-1.872 3.749-3.653 3.947.287.248.543.735.543 1.481 0 1.07-.009 1.932-.009 2.195 0 .213.144.462.55.384A8 8 0 0 0 8.001.196z"/> </g></symbol> <symbol id="icon-gitlab" viewBox="0 0 28 28"><g> <path d="M1.625 11.031L14 26.89.437 17.046a1.092 1.092 0 0 1-.391-1.203l1.578-4.813zm7.219 0h10.313L14.001 26.89zM5.75 1.469l3.094 9.562H1.625l3.094-9.562a.548.548 0 0 1 1.031 0zm20.625 9.562l1.578 4.813a1.09 1.09 0 0 1-.391 1.203l-13.563 9.844 12.375-15.859zm0 0h-7.219l3.094-9.562a.548.548 0 0 1 1.031 0z"/> </g></symbol> <symbol id="icon-google-plus" viewBox="0 0 16 16"><g> <path d="M5.091 7.147v1.747h2.888c-.116.75-.872 2.197-2.888 2.197-1.737 0-3.156-1.441-3.156-3.216s1.419-3.216 3.156-3.216c.991 0 1.65.422 2.028.784L8.5 4.112c-.888-.828-2.037-1.331-3.409-1.331C2.275 2.784 0 5.059 0 7.875s2.275 5.091 5.091 5.091c2.937 0 4.888-2.066 4.888-4.975 0-.334-.037-.591-.081-.844H5.092zM16 7h-1.5V5.5H13V7h-1.5v1.5H13V10h1.5V8.5H16z"/> </g></symbol> <symbol id="icon-instagram" viewBox="0 0 22 22"><g> <path d="M15.445 0H6.554A6.559 6.559 0 0 0 0 6.554v8.891A6.559 6.559 0 0 0 6.554 22h8.891a6.56 6.56 0 0 0 6.554-6.555V6.554A6.557 6.557 0 0 0 15.445 0zm4.342 15.445a4.343 4.343 0 0 1-4.342 4.342H6.554a4.341 4.341 0 0 1-4.341-4.342V6.554a4.34 4.34 0 0 1 4.341-4.341h8.891a4.342 4.342 0 0 1 4.341 4.341l.001 8.891z"/> <path d="M11 5.312A5.693 5.693 0 0 0 5.312 11 5.694 5.694 0 0 0 11 16.688 5.694 5.694 0 0 0 16.688 11 5.693 5.693 0 0 0 11 5.312zm0 9.163a3.475 3.475 0 1 1-.001-6.95 3.475 3.475 0 0 1 .001 6.95zm5.7-10.484a1.363 1.363 0 1 1-1.364 1.364c0-.752.51-1.364 1.364-1.364z"/> </g></symbol> <symbol id="icon-linkedin" viewBox="0 0 16 16"><g> <path d="M6 6h2.767v1.418h.04C9.192 6.727 10.134 6 11.539 6 14.46 6 15 7.818 15 10.183V15h-2.885v-4.27c0-1.018-.021-2.329-1.5-2.329-1.502 0-1.732 1.109-1.732 2.255V15H6V6zM1 6h3v9H1V6zM4 3.5a1.5 1.5 0 1 1-3.001-.001A1.5 1.5 0 0 1 4 3.5z"/> </g></symbol> <symbol id="icon-mail" viewBox="0 0 22 18"><g> <path fill="#000" d="M0 17.225V.776h22v16.447H0v.002zm3.011-1.815h15.978l-5.111-5.115L11 13.179l-2.877-2.883-5.112 5.114zm-1.216-1.275l5.077-5.09L1.795 3.98v10.155zm13.332-5.09l5.079 5.09V3.979l-5.079 5.066zm-4.126 1.588l8.022-8.027-16.045-.001 8.023 8.028z"/> </g></symbol> <symbol id="icon-medium" viewBox="0 0 24 24"><g> <path d="M22.085 4.733L24 2.901V2.5h-6.634l-4.728 11.768L7.259 2.5H.303v.401L2.54 5.594c.218.199.332.49.303.783V16.96c.069.381-.055.773-.323 1.05L0 21.064v.396h7.145v-.401l-2.52-3.049a1.244 1.244 0 0 1-.347-1.05V7.806l6.272 13.659h.729l5.393-13.659v10.881c0 .287 0 .346-.188.534l-1.94 1.877v.402h9.412v-.401l-1.87-1.831a.556.556 0 0 1-.214-.534V5.267a.554.554 0 0 1 .213-.534z"/> </g></symbol> <symbol id="icon-npm" viewBox="0 0 16 16"><g> <path d="M0 0v16h16V0H0zm13 13h-2V5H8v8H3V3h10v10z"/> </g></symbol> <symbol id="icon-pinterest" viewBox="0 0 16 16"><g> <path d="M8 1.069a6.93 6.93 0 0 0-2.525 13.384c-.059-.547-.116-1.391.025-1.988.125-.541.813-3.444.813-3.444s-.206-.416-.206-1.028c0-.963.559-1.684 1.253-1.684.591 0 .878.444.878.975 0 .594-.378 1.484-.575 2.306-.166.691.344 1.253 1.025 1.253 1.231 0 2.178-1.3 2.178-3.175 0-1.659-1.194-2.819-2.894-2.819-1.972 0-3.128 1.478-3.128 3.009 0 .597.228 1.234.516 1.581.056.069.066.128.047.2a95.89 95.89 0 0 1-.194.787c-.031.128-.1.153-.231.094-.866-.403-1.406-1.669-1.406-2.684 0-2.188 1.587-4.194 4.578-4.194 2.403 0 4.272 1.712 4.272 4.003 0 2.388-1.506 4.313-3.597 4.313-.703 0-1.362-.366-1.588-.797 0 0-.347 1.322-.431 1.647-.156.603-.578 1.356-.862 1.816a6.93 6.93 0 0 0 8.984-6.622 6.931 6.931 0 0 0-6.931-6.934z"/> </g></symbol> <symbol id="icon-search" viewBox="0 0 16 16"><g> <path d="M15.504 13.616l-3.79-3.223c-.392-.353-.811-.514-1.149-.499a6 6 0 1 0-.672.672c-.016.338.146.757.499 1.149l3.223 3.79c.552.613 1.453.665 2.003.115s.498-1.452-.115-2.003zM6 10a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/> </g></symbol> <symbol id="icon-strava" viewBox="0 0 24 24"><g> <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/> </g></symbol> <symbol id="icon-tumblr" viewBox="0 0 16 16"><g> <path d="M9.001 7v3.659c0 .928-.012 1.463.086 1.727.098.262.342.534.609.691.354.212.758.318 1.214.318.81 0 1.289-.107 2.09-.633v2.405a9.089 9.089 0 0 1-1.833.639A7.93 7.93 0 0 1 9.369 16a4.9 4.9 0 0 1-1.725-.276 4.195 4.195 0 0 1-1.438-.79c-.398-.343-.672-.706-.826-1.091s-.23-.944-.23-1.676V6.556H3.003V4.29c.628-.204 1.331-.497 1.778-.877a4.386 4.386 0 0 0 1.08-1.374C6.133 1.505 6.32.825 6.422 0h2.579v4H13v3H9.001z"/> </g></symbol> <symbol id="icon-twitter" viewBox="0 0 16 16"><g> <path d="M16 3.538a6.461 6.461 0 0 1-1.884.516 3.301 3.301 0 0 0 1.444-1.816 6.607 6.607 0 0 1-2.084.797 3.28 3.28 0 0 0-2.397-1.034 3.28 3.28 0 0 0-3.197 4.028 9.321 9.321 0 0 1-6.766-3.431 3.284 3.284 0 0 0 1.015 4.381A3.301 3.301 0 0 1 .643 6.57v.041A3.283 3.283 0 0 0 3.277 9.83a3.291 3.291 0 0 1-1.485.057 3.293 3.293 0 0 0 3.066 2.281 6.586 6.586 0 0 1-4.862 1.359 9.286 9.286 0 0 0 5.034 1.475c6.037 0 9.341-5.003 9.341-9.341 0-.144-.003-.284-.009-.425a6.59 6.59 0 0 0 1.637-1.697z"/> </g></symbol> <symbol id="icon-vimeo" viewBox="0 0 16 16"><g> <path d="M15.994 4.281c-.072 1.556-1.159 3.691-3.263 6.397-2.175 2.825-4.016 4.241-5.522 4.241-.931 0-1.722-.859-2.366-2.581-.431-1.578-.859-3.156-1.291-4.734-.478-1.722-.991-2.581-1.541-2.581-.119 0-.538.253-1.256.753l-.753-.969c.791-.694 1.569-1.388 2.334-2.081 1.053-.909 1.844-1.387 2.372-1.438 1.244-.119 2.013.731 2.3 2.553.309 1.966.525 3.188.647 3.666.359 1.631.753 2.447 1.184 2.447.334 0 .838-.528 1.509-1.588.669-1.056 1.028-1.862 1.078-2.416.097-.912-.262-1.372-1.078-1.372a2.98 2.98 0 0 0-1.184.263c.787-2.575 2.287-3.825 4.506-3.753 1.641.044 2.416 1.109 2.322 3.194z"/> </g></symbol> <symbol id="icon-wordpress" viewBox="0 0 16 16"><g> <path d="M2 8c0 2.313 1.38 4.312 3.382 5.259L2.52 5.622A5.693 5.693 0 0 0 2 8zm10.05-.295c0-.722-.266-1.222-.495-1.612-.304-.482-.589-.889-.589-1.371 0-.537.418-1.037 1.008-1.037.027 0 .052.003.078.005A6.064 6.064 0 0 0 8 2.156 6.036 6.036 0 0 0 2.987 4.79c.141.004.274.007.386.007.627 0 1.599-.074 1.599-.074.323-.018.361.444.038.482 0 0-.325.037-.687.055l2.185 6.33 1.313-3.835-.935-2.495a12.304 12.304 0 0 1-.629-.055c-.323-.019-.285-.5.038-.482 0 0 .991.074 1.58.074.627 0 1.599-.074 1.599-.074.323-.018.362.444.038.482 0 0-.326.037-.687.055l2.168 6.282.599-1.947c.259-.809.457-1.389.457-1.889zm-3.945.806l-1.8 5.095a6.148 6.148 0 0 0 3.687-.093.52.52 0 0 1-.043-.081L8.105 8.511zm5.16-3.315c.026.186.04.386.04.601 0 .593-.114 1.259-.456 2.093l-1.833 5.16c1.784-1.013 2.983-2.895 2.983-5.051a5.697 5.697 0 0 0-.735-2.803zM8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm0 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14z"/> </g></symbol> <symbol id="icon-youtube" viewBox="0 0 16 16"><g> <path d="M15.841 4.8s-.156-1.103-.637-1.587c-.609-.637-1.291-.641-1.603-.678-2.237-.163-5.597-.163-5.597-.163h-.006s-3.359 0-5.597.163c-.313.038-.994.041-1.603.678C.317 3.697.164 4.8.164 4.8S.005 6.094.005 7.391v1.213c0 1.294.159 2.591.159 2.591s.156 1.103.634 1.588c.609.637 1.409.616 1.766.684 1.281.122 5.441.159 5.441.159s3.363-.006 5.6-.166c.313-.037.994-.041 1.603-.678.481-.484.637-1.588.637-1.588s.159-1.294.159-2.591V7.39c-.003-1.294-.162-2.591-.162-2.591zm-9.494 5.275V5.578l4.322 2.256-4.322 2.241z"/> </g></symbol></svg>
  <header class="l-header">
    
    <p class="c-title p-title"><a href="https://www.hhyu.org/" class="p-title__link">Cortically Magnified</a></p>
    
    
    <p class="p-subtitle">
      Science, programming, books, and other interesting stuff
    </p>
    
  </header>

  <main id="main" class="l-main">


<article class="p-article h-entry">
  <header>
    <h1 class="p-name">Beautiful ideas in programming: generators and continuations</h1>
    <div>
      
        <div class="c-time">
          Posted on
<a class="u-url" href="https://www.hhyu.org/posts/generator_and_continuation/">
<time class="dt-published" datetime="2021-07-16T17:30:25&#43;11:00">
  Jul 16, 2021
</time>
</a>

        </div>
      
      
      <a href="https://www.hhyu.org/tags/programming" class="c-tag">programming</a>
      
      <a href="https://www.hhyu.org/tags/lisp" class="c-tag">LISP</a>
      
      <a href="https://www.hhyu.org/tags/python" class="c-tag">python</a>
      
      <a href="https://www.hhyu.org/tags/art-appreciation" class="c-tag">art appreciation</a>
      
    </div>
  </header>
  
  <section id="js-article" class="p-article__body e-content">
    <p>In this post, I&rsquo;ll summarize what I&rsquo;ve learned from an attempt to gain a deeper understanding of two important concepts in programming: Python&rsquo;s <a href="https://en.wikipedia.org/wiki/Generator_(computer_programming)">generators</a> and Scheme&rsquo;s <a href="https://en.wikipedia.org/wiki/Continuation">continuation</a>. The aim is not to teach Python or Scheme programming. Rather, what I want to do is to demonstrate that generators are special cases of a much more powerful construct - continuations. Continuations allow programmers to invent new control structures, and it is the foundation upon which iterators, generators, coroutines, and many other useful constructs can be built. I have found it very useful to understand how generators work from the deeper and broader perspective of continuations.</p>
<p>Continuation is well-established in programming language theory (it was introduced in the 70&rsquo;s), but its use has not become mainstream. However, I suspect that in the age of cloud computing and big data, where lazy evaluation is becoming increasingly important, continuation will become more prominent, like many other concepts in functional programming. I think it&rsquo;s worthy of your time to reserve a place for this concept in your peripheral vision.</p>
<p>For those who are not familiar with Scheme: <a href="https://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a> is a relatively modern dialect of one of the oldest programming languages: LISP. Scheme is a minimalist but highly expressive language, which makes it an ideal vehicle for experimenting with advanced concepts in programming. This is why Scheme is often used as a tool for teaching computer science, and as a playground for programming language researchers. Continuation is not unique to Scheme, but Scheme is the first language that treats continuations as first-class entities, thus making them easily manipulatable. It is the most natural venue for exploring continuations.</p>
<h1 id="making-generators-in-python-with-yield">Making generators in Python with &ldquo;yield&rdquo;</h1>
<p>In Python, generators are primarily used to make complex loops easier to write and to maintain. That&rsquo;s why they are special cases of iterators. In a traditional language like c, a <code>for</code> loop looks like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#a2f;font-weight:bold">for</span>(i<span style="color:#666">=</span><span style="color:#666">0</span>; i<span style="color:#666">&lt;</span><span style="color:#666">10</span>; i<span style="color:#666">++</span>)
  printf(<span style="color:#b44">&#34;%i &#34;</span>, i);
</code></pre></div><p>The first line specifies the sequence of numbers to iterate over with. The second line is what we want to do with those numbers. With generators in Python, we can write this type of loops like the example given below. In it, we use the <code>squared_ints()</code> generator to produce a sequence of squared integers one by one, and then use the <code>sum_of_squares()</code> function to accumulate them until the sum is greater than a bound specified by the programmer:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">squared_ints</span>():
    <span style="color:#b44">&#39;&#39;&#39; Infinite generator
</span><span style="color:#b44">        Return i^2 for i = 1, 2, ...
</span><span style="color:#b44">    &#39;&#39;&#39;</span>
    i <span style="color:#666">=</span> <span style="color:#666">1</span>
    <span style="color:#a2f;font-weight:bold">while</span> True:
        <span style="color:#a2f;font-weight:bold">yield</span> i<span style="color:#666">*</span>i   <span style="color:#080;font-style:italic"># it is this yield that makes this function a generator</span>
        i <span style="color:#666">+=</span> <span style="color:#666">1</span>

<span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">sum_of_squares</span>(bound):
    <span style="color:#b44">&#39;&#39;&#39; Return the smallest sum of squared integers greater than the bound
</span><span style="color:#b44">    &#39;&#39;&#39;</span>
    g <span style="color:#666">=</span> squared_ints()
    s <span style="color:#666">=</span> <span style="color:#666">0</span>
    <span style="color:#a2f;font-weight:bold">for</span> i <span style="color:#a2f;font-weight:bold">in</span> g:       <span style="color:#080;font-style:italic"># iterate over generator g</span>
        s <span style="color:#666">+=</span> i        <span style="color:#080;font-style:italic"># accumulate the sum s</span>
        <span style="color:#a2f;font-weight:bold">if</span> s<span style="color:#666">&gt;</span>bound:   <span style="color:#080;font-style:italic"># exit the loop if s is larger than n</span>
            <span style="color:#a2f;font-weight:bold">return</span> s
</code></pre></div><p>The definition of <code>squared-ints()</code> looks like a regular function, but the presence of the <code>yield</code> keyword makes it a function that produces generators [1]. Using the <code>next()</code> function on a generator <code>g</code>, we can see that the numbers are generated one by one. Generators work nicely with loops in Python. An example can be seen in <code>sum_of_squares()</code>, where we iterate over a generator with a <code>for</code> loop.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#666">&gt;&gt;&gt;</span> g <span style="color:#666">=</span> squared_ints()
<span style="color:#666">&gt;&gt;&gt;</span> g
<span style="color:#666">&lt;</span>generator <span style="color:#a2f">object</span> squared_ints at <span style="color:#666">0x7fcf48143830</span><span style="color:#666">&gt;</span>
<span style="color:#666">&gt;&gt;&gt;</span> <span style="color:#a2f">next</span>(g)
<span style="color:#666">1</span>
<span style="color:#666">&gt;&gt;&gt;</span> <span style="color:#a2f">next</span>(g)
<span style="color:#666">4</span>
<span style="color:#666">&gt;&gt;&gt;</span> <span style="color:#a2f">next</span>(g)
<span style="color:#666">9</span>
<span style="color:#666">&gt;&gt;&gt;</span> sum_of_squares(<span style="color:#666">100</span>)
<span style="color:#666">140</span>
</code></pre></div><p>Let&rsquo;s review what we have accomplished so far. In c-style loops, the generation and the consumption of the sequence are tightly coupled. In the Python code above, however, they are decomposed into two independent entities. Because generators can be build on other generators, you can further decompose a complex generator into a chain of simpler generators. This makes complex loops more modular and reusable, and therefore easier to write and maintain. Another improvement is that the generator code does not set a limit on the length of the sequence. It is theoretically infinite. The actual length of the sequence generated is determined by the code that consumes the sequence. This means that the generator code can be as general as possible, leaving computational efficiency to the consumer. This &ldquo;laziness&rdquo; is highly desirable in situations where generating the next item in the sequence is computationally expensive.</p>
<p>All of this is made possible by one single keyword <code>yield</code>! It&rsquo;s pretty amazing, isn&rsquo;t it? What happens is that every time <code>yield</code> is called, the state of the function is frozen, and the flow of control is yielded to the caller, along with the generated value [2]. The next time the generator is evoked, the control flow is returned to the frozen state of the generator.</p>
<p>What a simple and elegant syntax for a complex behavior! It&rsquo;s like magic. However, there is a part of me (perhaps the theorist in me) that is uncomfortable with magical behaviors in programming languages. How does <code>yield</code> create a generator (i.e., an object of the generator class) from a function definition? Why isn&rsquo;t this magic found in other places in the language? Why can&rsquo;t you call <code>yield</code> outside a function? In addition, generators provide some facilities for making coroutines - a topic in concurrent programming. What does concurrency have anything to do with iteration? Since all these behaviors appears to be associated with <code>yield</code> in an <em>ad hoc</em> way, I tend to write generators idiomatically, following a memorized recipe without thinking about the heavy machinery behind the curtain. I always have a nagging feeling that there is a bigger picture that I don&rsquo;t see.</p>
<p>This was when I realized that I had read about similar ideas in a different context before. When I learned to program in college, I had a copy of <a href="https://www.cs.unm.edu/~williams/cs357/springer-friedman.pdf">Scheme and the Art of Programming</a> by Springer and Friedman. There was a chapter on the mysterious concept of &ldquo;continuation&rdquo;, where all of this stuff was discussed. I skipped the entire chapter because I couldn&rsquo;t understand what continuations were good for. Maybe it&rsquo;s time to revisit this topic.</p>
<h1 id="python-style-generators-in-scheme">Python-style generators in Scheme</h1>
<p>Before we move on to continuations, rest assured that Python-style generators are available in Scheme. They are not part of the language itself, but with the <code>make-coroutine-generator</code> function in a quasi-standard library (i.e., <a href="https://srfi.schemers.org/srfi-158/srfi-158.html">SRFI-158</a>), the <code>squared-ints</code> generator discussed previously can be written in Scheme as:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">squared-ints</span>          <span style="color:#080;font-style:italic">;;; squared-ints is a function (lambda) that makes a generator</span>
  (<span style="color:#a2f;font-weight:bold">lambda </span>()
    (<span style="color:#00a000">make-coroutine-generator</span>
     (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">yield</span>)
       (<span style="color:#a2f;font-weight:bold">let </span><span style="color:#b8860b">loop</span> ((<span style="color:#00a000">i</span> <span style="color:#666">1</span>))      <span style="color:#080;font-style:italic">;;; define recursive function &#34;loop&#34; which increases i, starting from 1 </span>
	     (<span style="color:#00a000">yield</span> (<span style="color:#a2f">* </span><span style="color:#b8860b">i</span> <span style="color:#b8860b">i</span>))
	     (<span style="color:#00a000">loop</span> (<span style="color:#a2f">+ </span><span style="color:#b8860b">i</span> <span style="color:#666">1</span>)))))))

(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">g</span> (<span style="color:#00a000">squared-ints</span>))     <span style="color:#080;font-style:italic">;;; make a generator, assign it to &#34;g&#34; </span>
</code></pre></div><p>This doesn&rsquo;t look as elegant as the Python code, but logic is almost identical [3]. What is different here is that <code>yield</code> in Scheme is not a reserved keyword baked into the interpreter. Rather, the mechanism for yielding control is achieved by manipulating &ldquo;continuations&rdquo; - a fundamental building block of the language that represents computational steps that are pending execution. In fact, <code>make-coroutine-generator</code> is just a regular Scheme function consisting of ~10 lines of code. It can be implemented by any competent Scheme programmer without too much work. How is it possible? The magic is the use of <code>call/cc</code> (which stands for &ldquo;call with current continuation&rdquo;) in <code>make-coroutine-generator</code>. Note that nothing in this code refers to a special class or keyword. <code>make-coroutine-generator</code>, <code>yield</code>, and <code>g</code> are all nothing more than regular functions. This is why we ask for the next value by calling it like a function:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#b8860b">&gt;</span> <span style="color:#b8860b">g</span>
<span style="color:#666">#</span><span style="color:#b8860b">&lt;procedure&gt;</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">g</span>)
<span style="color:#666">1</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">g</span>)
<span style="color:#666">4</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">g</span>)
<span style="color:#666">9</span>
</code></pre></div><p>The beauty of Scheme generators is that the library does not introduce a new class of entities, so generators can integrate seamlessly with the rest of the language.</p>
<h1 id="what-are-continuations">What are continuations?</h1>
<p>Simply put, a continuation is a series of computational steps that are pending execution. For example, <code>0 + 1 + 2</code> is expressed in Scheme as <code>(+ 2 (+ 1 0))</code>. From the perspective of <code>0</code>, what will happen is that 1 will be added to it, and then 2 will be added to the result. The continuation of <code>0</code> in this context is therefore these two additions. The beauty of Scheme is that a continuation is not an exotic construct. Rather, it is just a function that can be easily manipulated by the programmer. In this example, the continuation is nothing other than <code>(lambda (x) (+ 2 (+ 1 x)))</code>. It is equivalent to <code>lambda x: x + 1 + 2</code> in Python.</p>
<p>In Scheme, we can use a function named <code>call-with-current-continuation</code> (or <code>call/cc</code> for short) to capture the current continuation, and then pass it to a different function, which is sometimes called the <em>receiver</em>. Most programming languages don&rsquo;t have this construct, so it will take a little bit of time to get used to it.</p>
<p>Consider this simple receiver, which simply stores the continuation in a global variable &lsquo;c&rsquo;.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">c</span> <span style="color:#800">#f</span>)                <span style="color:#080;font-style:italic">;;; initially, global variable c stores nothing</span>

(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">store-continuation</span>   <span style="color:#080;font-style:italic">;;; define a function store-continuation</span>
  (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">cc</span>)               <span style="color:#080;font-style:italic">;;; which receives a continuation</span>
    (<span style="color:#a2f;font-weight:bold">set! </span><span style="color:#b8860b">c</span> <span style="color:#b8860b">cc</span>)              <span style="color:#080;font-style:italic">;;; store it to the global variable c</span>
    <span style="color:#666">0</span>))                      <span style="color:#080;font-style:italic">;;; and returns 0</span>
</code></pre></div><p>We can now use it to capture the continuation of <code>0</code> in <code>(+ 2 (+ 1 0))</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#b8860b">&gt;</span> <span style="color:#b8860b">c</span>                 <span style="color:#080;font-style:italic">;; nothing is stored in c</span>
<span style="color:#800">#f</span> 

<span style="color:#b8860b">&gt;</span> (<span style="color:#a2f">+ </span><span style="color:#666">2</span>
   (<span style="color:#a2f">+ </span><span style="color:#666">1</span>
     (<span style="color:#a2f">call/cc </span><span style="color:#b8860b">store-continuation</span>)))
<span style="color:#666">3</span>

<span style="color:#b8860b">&gt;</span> <span style="color:#b8860b">c</span>
<span style="color:#666">#</span><span style="color:#b8860b">&lt;procedure</span> (<span style="color:#00a000">continuation</span> <span style="color:#666">.</span> <span style="color:#b8860b">results1887</span>)<span style="color:#b8860b">&gt;</span>
</code></pre></div><p>The returned value of <code>(+2 (+ 1 (call/cc store-continuation)))</code> is not important. The important part is that after the <code>call/cc</code> call, the <code>c</code> variable stores a function, which is the continuation we captured! We can&rsquo;t see the code, because it is compiled, but we can verify that it is effectively <code>(lambda (x) (+2 (+ 1 x)))</code>, because when we call <code>c</code> with a number, the returned value is the input plus 3.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">c</span> <span style="color:#666">0</span>)
<span style="color:#666">3</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">c</span> <span style="color:#666">10</span>)
<span style="color:#666">13</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">c</span> <span style="color:#666">-100</span>)
<span style="color:#666">-97</span>
</code></pre></div><h1 id="controlling-the-flow-of-execution-with-continuations">Controlling the flow of execution with continuations</h1>
<p>Let&rsquo;s use <code>call/cc</code> to do something useful. Let&rsquo;s use it to implement the logic of the Python function <code>sum_of_squares()</code> in Scheme. As before, we iterate over the generator in a loop, accumulate the sum, and stop when the sum is bigger than a certain bound.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">sum-of-squares</span>
  (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">bound</span>)                        <span style="color:#080;font-style:italic">;; define (sum-of-squares bound)</span>
      (<span style="color:#00a000">call/cc</span>
       (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">break</span>)                   <span style="color:#080;font-style:italic">;; define a reciever: first capture the continuation into break</span>
	     (<span style="color:#a2f;font-weight:bold">let </span>((<span style="color:#00a000">g</span> (<span style="color:#00a000">squared-ints</span>)))       <span style="color:#080;font-style:italic">;; make the generator g</span>
	       (<span style="color:#a2f;font-weight:bold">let </span><span style="color:#b8860b">loop</span> ((<span style="color:#00a000">s</span> <span style="color:#666">0</span>))             <span style="color:#080;font-style:italic">;; define the recursive function (loop s), where s is the accumulated value</span>
	         (<span style="color:#a2f;font-weight:bold">let </span>((<span style="color:#00a000">new-s</span> (<span style="color:#a2f">+ </span><span style="color:#b8860b">s</span> (<span style="color:#00a000">g</span>))))    <span style="color:#080;font-style:italic">;; compute the new accumulated value</span>
	           (<span style="color:#a2f;font-weight:bold">if </span>(<span style="color:#a2f">&gt; </span><span style="color:#b8860b">new-s</span> <span style="color:#b8860b">bound</span>)       <span style="color:#080;font-style:italic">;; if the new accumulated value is larger than bound</span>
		           (<span style="color:#00a000">break</span> <span style="color:#b8860b">new-s</span>)         <span style="color:#080;font-style:italic">;; exit the loop</span>
		           (<span style="color:#00a000">loop</span> <span style="color:#b8860b">new-s</span>)))))))))  <span style="color:#080;font-style:italic">;; otherwise, continue the loop with the new accumulated value</span>

<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">sum-of-squares</span> <span style="color:#666">100</span>)
<span style="color:#666">140</span>
</code></pre></div><p>Before the <code>sum-of-square</code> function does anything, I use <code>call/cc</code> to capture the continuation, and assign it to the variable <code>break</code>. Notice that in the syntax of Scheme, this is the last step of the function. Therefore, calling <code>break</code> will immediately exist the function with a returned value, no matter where it is called. This doesn&rsquo;t seem to be too impressive in this simple example, but what is means is that if you have to work with a big and deeply nested data structure (for example, a tree or a graph), you can program with the elegance of recursion, but with the ability to abandon the recursion as soon as some condition is met. This can dramatically reduce unnecessary computation.</p>
<p>Some people call <code>call/cc</code> the <code>GOTO</code> statement of functional languages, but a better characterization is that it is a general mechanism for programmers to created new control structures that don&rsquo;t exist in the core language. With <code>call/cc</code>, all forms of control, including exceptions, backtracking, and coroutines can be built. Since no magic is involved, you can create your customized versions of these structures if you don&rsquo;t like how they behave. Novel control structures that are specific to the problem domain can also be invented. For example, in web programming, continuations have been used to control the logic of server applications (see <a href="https://thelackthereof.org/docs/library/cs/continuations.pdf">here</a>).</p>
<p>Note that I wrote the program above to mirror the logic of the Python code. There are better ways to achieve the same without recursion or <code>call/cc</code>. For example, in the example below, I used the generator library to create a second infinite generator <code>acc</code> to accumulate the sum of elements in the <code>gen</code> generator, and then use the <code>generator-find</code> function to get the first value in <code>acc</code> that is larger than <code>bound</code>. This is an example of chaining iterators to make more complex iterators.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">sum-of-squares</span>
	(<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">bound</span>)
		(<span style="color:#a2f;font-weight:bold">let* </span>((<span style="color:#00a000">gen</span> (<span style="color:#00a000">squared-ints</span>))               <span style="color:#080;font-style:italic">;; create a generator gen</span>
		       (<span style="color:#00a000">acc</span> (<span style="color:#00a000">make-unfold-generator</span>        <span style="color:#080;font-style:italic">;; create a second generator acc</span>
		            (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">s</span>) <span style="color:#800">#f</span>)               <span style="color:#080;font-style:italic">;; no stop condition, make acc an infinite generator</span>
		            (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">s</span>) <span style="color:#b8860b">s</span>)                
		            (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">s</span>) (<span style="color:#a2f">+ </span><span style="color:#b8860b">s</span> (<span style="color:#00a000">gen</span>)))      <span style="color:#080;font-style:italic">;; accumulate the next value from gen</span>
		            <span style="color:#666">0</span>)))                          <span style="color:#080;font-style:italic">;; accumulate from 0</span>
					
      (<span style="color:#00a000">generator-find</span>                             <span style="color:#080;font-style:italic">;; find the first value bigger than bound in the acc generator</span>
       (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">s</span>) (<span style="color:#a2f">&gt; </span><span style="color:#b8860b">s</span> <span style="color:#b8860b">bound</span>))
       <span style="color:#b8860b">acc</span>))))
</code></pre></div><h1 id="creating-generators-with-callcc">Creating generators with call/cc</h1>
<p>In the previous section, we use <code>call/cc</code> to break from a loop that iterates over a generator. Let&rsquo;s implement the generator itself with <code>call/cc</code>. To make it happen, we need a mechanism to yield - to exit a function before it ends normally. We have already seen how it is done. Now, we need a mechanism that resumes the function after it has yielded. It&rsquo;s not hard to see that we need two continuations.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">squared-ints</span>
  (<span style="color:#a2f;font-weight:bold">lambda </span>()
    (<span style="color:#a2f;font-weight:bold">let* </span>((<span style="color:#00a000">break</span> <span style="color:#800">#f</span>)                  <span style="color:#080;font-style:italic">;;; will store a continuation to break out of the function</span>
	       (<span style="color:#00a000">resume</span> <span style="color:#800">#f</span>)                 <span style="color:#080;font-style:italic">;;; will store a continuation to resume after yielding</span>
	       (<span style="color:#00a000">yield</span>                      <span style="color:#080;font-style:italic">;;; define the function &#34;yield&#34;</span>
	         (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">value</span>)
	          (<span style="color:#a2f">call/cc </span>                <span style="color:#080;font-style:italic">;;;   capture the current continuation</span>
	            (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">r</span>)
		         (<span style="color:#a2f;font-weight:bold">set! </span><span style="color:#b8860b">resume</span> <span style="color:#b8860b">r</span>)       <span style="color:#080;font-style:italic">;;;   store it in &#34;resume&#34;</span>
		         (<span style="color:#00a000">break</span> <span style="color:#b8860b">value</span>))))))    <span style="color:#080;font-style:italic">;;;   and break out </span>
      
      (<span style="color:#a2f;font-weight:bold">lambda </span>()                       <span style="color:#080;font-style:italic">;;; will return a function (a closure)</span>
	    (<span style="color:#a2f">call/cc </span>                      <span style="color:#080;font-style:italic">;;; capture the current continuation...</span>
	      (<span style="color:#a2f;font-weight:bold">lambda </span>(<span style="color:#00a000">cc</span>)
	       (<span style="color:#a2f;font-weight:bold">set! </span><span style="color:#b8860b">break</span> <span style="color:#b8860b">cc</span>)             <span style="color:#080;font-style:italic">;;; ...and store it in &#34;break&#34;</span>
	       (<span style="color:#a2f;font-weight:bold">if </span><span style="color:#b8860b">resume</span>                  <span style="color:#080;font-style:italic">;;; if this generator has been called before...</span>
	           (<span style="color:#00a000">resume</span> <span style="color:#666">&#39;</span>())            <span style="color:#080;font-style:italic">;;; ... resume it</span>
	           (<span style="color:#a2f;font-weight:bold">let </span><span style="color:#b8860b">loop</span> ((<span style="color:#00a000">i</span> <span style="color:#666">1</span>))       <span style="color:#080;font-style:italic">;;; otherwise, loop through i=1, 2, 3, 4...</span>
		         (<span style="color:#00a000">yield</span> (<span style="color:#a2f">* </span><span style="color:#b8860b">i</span> <span style="color:#b8860b">i</span>))       <span style="color:#080;font-style:italic">;;; yield the square of i</span>
		         (<span style="color:#00a000">loop</span> (<span style="color:#a2f">+ </span><span style="color:#b8860b">i</span> <span style="color:#666">1</span>))))))))))

(<span style="color:#a2f;font-weight:bold">define </span><span style="color:#b8860b">g</span> (<span style="color:#00a000">squared-ints</span>))

<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">g</span>)
<span style="color:#666">1</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">g</span>)
<span style="color:#666">4</span>
<span style="color:#b8860b">&gt;</span> (<span style="color:#00a000">g</span>)
<span style="color:#666">9</span>
</code></pre></div><p>I modified this code slightly from Vasilij Schneidermann&rsquo;s implementation of the SRFI-158 library (see <a href="https://depp.brause.cc/srfi-158/">here</a> for the full source code). It looks a bit intimidating to those who are not expert Scheme programmers, but the logic is very straightforward: for every number <code>i</code> in the loop, first store the future of the computation into an internal variable called <code>resume</code>, and then call the <code>break</code> continuation as we have done before to exist the function. The next time the generator is called, call the <code>resume</code> continuation, which will progress to the next number in the loop.</p>
<p>Note that in the code above, we return a generator as a function with no argument. We can easily add an argument to the function, so that messages can be sent to the generator after the iteration has started. For example, we can modify the code such that <code>(g 'reset)</code> will reset the iteration. Since generators are just functions in Scheme, communicating with generators can be done naturally with regular function calls. In Python, you can also send messages to generators, but it requires a special syntax of the <code>yield</code> keyword, and the <code>.send()</code> method of the generator class. Again, working with generators in Python is idiomatic, with lots of things happening behind the curtain.</p>
<h1 id="a-few-words-on-coroutines">A few words on coroutines</h1>
<p>I had planned to go into details about coroutines, because Python&rsquo;s tutorials on generators and Scheme&rsquo;s tutorials on continuations both tend to end with coroutines (How interesting!). However, I have decided against the idea because it will derail the discussion into a different territory.</p>
<p>But very briefly, <code>yield</code> in Python is often presented as a simplified method for writing generators, but what it does, suspending the execution of a function with the ability to resume it, is a much general concept than iteration. It enable a routine to do a small amount of work, and then pass the control to another routine, thus allowing them to run concurrently. This enables data to be processed by a network of routines, which do not have to be organized as a linear pipeline. It is more flexible and powerful than iteration. In other words, although generators are used for iterations, <code>yield</code> doesn&rsquo;t have to be.</p>
<p>The story is much simpler in Scheme. Since entities in Scheme are not organized hierarchically as classes, you don&rsquo;t have the awkwardness of implementing coroutines with a class that is designed primarily for iterations. In Scheme, coroutines and generators are just normal functions that manipulate continuations in different ways.</p>
<h1 id="beautiful-ideas">Beautiful ideas</h1>
<p>I wrote this post primarily to summarize something new that I have learned. I also did it as an exercise in art appreciation. A lot of people like to talk about why they love a song, a TV show, or a novel. I would like to see more words spent on articulating why an idea is elegant, powerful, or clever.</p>
<p>Scheme is an unusual language in its minimalism. Its designers want it to be highly expressive (meaning that complex logic can be expressed succinctly), and yet as simple as possible. This can only be achieved by building the language on a small number of powerful ideas. A powerful idea is not narrow in scope. A powerful idea stays true to itself, but when it is used in combination with other powerful ideas, new functionalities emerge. This is where the expressiveness comes from. A poetic way to express this magic (due to <a href="https://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist)">John McCarthy</a>) is that it almost feel like the language was discovered rather than invented. Once you get it, it&rsquo;s hard to imagine how a language can be designed in any other way, because every component seems to be incomplete without the others.</p>
<p>I am obviously a fan of this philosophy. However, I am not blind to the fact that powerful ideas are much harder to master. Continuations are hard to understand and hard to write. The fact that I am still thinking about continuations so many years after my college programming class should tell you something about the level of devotion needed to reach the blissful state of pure lambda enlightenment. This brings me to Python. As I said before, the minimalist in me is bothered by the hidden machinery behind generators. But with the <code>yield</code> keyword, anybody can learn the idioms and start to use generators in 10 minutes. It is perhaps not as powerful an idea as continuations, but it is powerful enough that it blends in nicely with loops, making complex loops dramatically easier to write. It&rsquo;s a beautiful idea.</p>
<p>In the end, I feel compelled to circle back to Scheme. What is beautiful about Python&rsquo;s generators is that <code>yield</code> is a minimal interface to a powerful idea. You might say the same about Scheme&rsquo;s continuations and macros. With <code>call/cc</code> and <code>define-macro</code>, the machinery of the interpreter become accessible to the programmer, thus erasing the boundary between programming and metaprogramming. A lot has been written on this topic so I won&rsquo;t repeat it here (see <a href="http://www.paulgraham.com/avg.html">here</a>), but parsing (accessible via macros) and execution control (accessible via <code>call/cc</code>) are basically what the interpreter does. I am amazed by how minimal the API to the interpreter is. That is beautiful.</p>
<h1 id="notes">Notes</h1>
<p>[1] Using <code>yield</code> in a function definition is not the only way in which generators can be constructed in Python. Please consult any general tutorial on generators.</p>
<p>[2] More accurately, <code>yield</code> in a function creates a generator, which suspends its execution at the point where <code>yield</code> appears in the definition. This characterization is harder to read, so I will write as if <code>yield</code> actually does the yielding. The intention of the syntax is to create this illusion.</p>
<p>[3] Note that recursion is Scheme&rsquo;s preferred way for writing loops. It isn&rsquo;t necessary for creating generators. Since this is a form of tail recursion, the Scheme interpreter automatically translates the recursion into a loop.</p>

  </section>
  <footer>
    
    <nav class="p-pagination c-pagination">
      <div class="c-pagination__ctrl">
        <div class="c-pagination__newer">
          
          <a href="https://www.hhyu.org/posts/elisp_advice/">Newer</a>
          
        </div>
        <div class="c-pagination__older">
          
          <a href="https://www.hhyu.org/posts/shell_regexp/">Older</a>
          
        </div>
      </div>
    </nav>
    
    
<aside class="p-author">
  
  <div class="c-avatar p-author__avatar">
    <img alt="Author Avatar" src="/sitewide/logo.png" />
  </div>
  
  
  <div class="p-author__body">
    
    <p class="c-title p-author__name ">Hsin-Hao Yu</p>
    
    
    <p class="p-note">A Taiwanese scientist living in Melbourne</p>
    
    
    <p>
      <a href="mailto:hsinhaohh.yu@gmail.com">
        Contact me
      </a>
    </p>
    
  </div>
  
</aside>


  </footer>
</article>
  </main>
  
<nav class="l-nav p-menu">
  <ul class="p-menu__lists">
    
      
        <li class="p-menu__listitem p-menu__parent">
          <span>/About</span>
          <ul>
            
              <li class="p-menu__listitem p-menu__child"><a href="/about">Me</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/about_site">This site</a></li>
            
          </ul>
        </li>
      
    
      
        <li class="p-menu__listitem p-menu__parent">
          <span>/Work</span>
          <ul>
            
              <li class="p-menu__listitem p-menu__child"><a href="/research">Research</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/publications">CV and Publications</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/gallery">Visualization Gallery</a></li>
            
          </ul>
        </li>
      
    
      
        <li class="p-menu__listitem p-menu__parent">
          <span>/Updates</span>
          <ul>
            
              <li class="p-menu__listitem p-menu__child"><a href="/code">Code</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/">Blog</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="/micro/">Notes</a></li>
            
              <li class="p-menu__listitem p-menu__child"><a href="https://github.com/hsinhaoyu/resources">References</a></li>
            
          </ul>
        </li>
      
    
      
      <li class="p-menu__listitem">
        <a href="/tags">Tags</a>
      </li>
      
    
  </ul>
</nav>


  <footer class="l-footer">
    
<ul class="c-links">
  
  
  <li class="c-links__item">
    <a href="https://twitter.com/HsinHaoYu" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>twitter</title>
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </li>
  
  
  
  <li class="c-links__item">
    <a href="https://instagram.com/hhyu00" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>instagram</title>
        <use xlink:href="#icon-instagram"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://github.com/hsinhaoyu" target="_blank" rel="me">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>github</title>
        <use xlink:href="#icon-github"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://gitlab.com/hsinhaoyu" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>gitlab</title>
        <use xlink:href="#icon-gitlab"></use>
      </svg>
    </a>
  </li>
  
  
  
  
  
  
  
  
  
  
  
  <li class="c-links__item">
    <a href="https://linkedin.com/in/hhyu" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>linkedin</title>
        <use xlink:href="#icon-linkedin"></use>
      </svg>
    </a>
  </li>
  
  
</ul>



    <p class="p-copyright">
      
        
          
            <a class="h-card" href="https://hhyu.org">Hsin-Hao Yu</a>
          
        
        &nbsp;&bull;&nbsp;
        2022

        
          &nbsp;&bull;&nbsp;
          <a href="https://www.hhyu.org/">Cortically Magnified</a>
        
      
    </p>
  </footer>

</body>
</html>

